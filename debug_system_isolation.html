<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œìŠ¤í…œ ê²©ë¦¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 8px; }
        .success { border-color: #4CAF50; background: #1b2f1b; }
        .error { border-color: #f44336; background: #2f1b1b; }
        button { padding: 10px 20px; margin: 5px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1976D2; }
        pre { background: #333; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .status { margin: 10px 0; padding: 5px; border-radius: 4px; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #555; background: #2a2a2a; color: #fff; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>ğŸ” Casino-Club F2P ì‹œìŠ¤í…œ ê²©ë¦¬ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- ì¸ì¦ ì„¹ì…˜ -->
    <div class="section" id="auth-section">
        <h2>ğŸ” 1. ì¸ì¦ ì‹œìŠ¤í…œ</h2>
        <div>
            <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„" value="debug_user">
            <input type="email" id="email" placeholder="ì´ë©”ì¼" value="debug@test.com">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" value="password123">
            <input type="text" id="invite_code" placeholder="ì´ˆëŒ€ì½”ë“œ" value="DEBUG2024">
            <button onclick="testSignup()">íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸</button>
            <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
        </div>
        <div id="auth-status" class="status"></div>
        <pre id="auth-result"></pre>
    </div>

    <!-- ìƒì  ì‹œìŠ¤í…œ ì„¹ì…˜ -->
    <div class="section" id="shop-section">
        <h2>ğŸ›ï¸ 2. ìƒì  ì‹œìŠ¤í…œ (ê²©ë¦¬ í…ŒìŠ¤íŠ¸)</h2>
        <div>
            <button onclick="testShopCatalog()">ì¹´íƒˆë¡œê·¸ ì¡°íšŒ</button>
            <button onclick="testShopProducts()">ìƒí’ˆ ëª©ë¡</button>
            <button onclick="testUserBalance()">ì”ì•¡ ì¡°íšŒ</button>
            <button onclick="testShopBuy()">êµ¬ë§¤ í…ŒìŠ¤íŠ¸ (ì¸ì¦ í•„ìš”)</button>
        </div>
        <div id="shop-status" class="status"></div>
        <pre id="shop-result"></pre>
    </div>

    <!-- ì´ë²¤íŠ¸/ë¯¸ì…˜ ì‹œìŠ¤í…œ ì„¹ì…˜ -->
    <div class="section" id="event-section">
        <h2>ğŸ¯ 3. ì´ë²¤íŠ¸/ë¯¸ì…˜ ì‹œìŠ¤í…œ (ê²©ë¦¬ í…ŒìŠ¤íŠ¸)</h2>
        <div>
            <button onclick="testEventsList()">ì´ë²¤íŠ¸ ëª©ë¡</button>
            <button onclick="testMissionsList()">ë¯¸ì…˜ ëª©ë¡</button>
            <button onclick="testEventJoin()">ì´ë²¤íŠ¸ ì°¸ì—¬</button>
            <button onclick="testMissionClaim()">ë¯¸ì…˜ ë³´ìƒ ìˆ˜ë ¹</button>
        </div>
        <div id="event-status" class="status"></div>
        <pre id="event-result"></pre>
    </div>

    <!-- ì–´ë“œë¯¼ ì‹œìŠ¤í…œ ì„¹ì…˜ -->
    <div class="section" id="admin-section">
        <h2>âš™ï¸ 4. ì–´ë“œë¯¼ ì‹œìŠ¤í…œ (ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸)</h2>
        
        <!-- ì–´ë“œë¯¼ ì¸ì¦ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ” ì–´ë“œë¯¼ ì¸ì¦</h4>
            <input type="text" id="admin_nickname" placeholder="ì–´ë“œë¯¼ ë‹‰ë„¤ì„" value="admin">
            <input type="password" id="admin_password" placeholder="ì–´ë“œë¯¼ ë¹„ë°€ë²ˆí˜¸" value="admin123">
            <button onclick="testAdminLogin()">ì–´ë“œë¯¼ ë¡œê·¸ì¸</button>
        </div>

        <!-- ì‚¬ìš©ì ê´€ë¦¬ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h4>
            <button onclick="testAdminUsers()">ì‚¬ìš©ì ëª©ë¡</button>
            <button onclick="testAdminUserCreate()">ì‚¬ìš©ì ìƒì„±</button>
            <button onclick="testAdminUserDetail()">ì‚¬ìš©ì ìƒì„¸</button>
            <button onclick="testAdminUserElevate()">ê¶Œí•œ ìŠ¹ê²©</button>
            <button onclick="testAdminUserBan()">ì‚¬ìš©ì ì°¨ë‹¨</button>
            <button onclick="testAdminUserTokens()">í† í° ì§€ê¸‰</button>
        </div>

        <!-- ìƒì  ê´€ë¦¬ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ›ï¸ ìƒì  ê´€ë¦¬</h4>
            <button onclick="testAdminShopProducts()">ìƒí’ˆ ëª©ë¡</button>
            <button onclick="testAdminShopCreate()">ìƒí’ˆ ìƒì„±</button>
            <button onclick="testAdminShopUpdate()">ìƒí’ˆ ìˆ˜ì •</button>
            <button onclick="testAdminShopActivate()">ìƒí’ˆ í™œì„±í™”</button>
            <button onclick="testAdminShopStats()">ìƒì  í†µê³„</button>
            <button onclick="testAdminShopCategories()">ì¹´í…Œê³ ë¦¬ ëª©ë¡</button>
        </div>

        <!-- ì´ë²¤íŠ¸ ê´€ë¦¬ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ¯ ì´ë²¤íŠ¸ ê´€ë¦¬</h4>
            <button onclick="testAdminEvents()">ì´ë²¤íŠ¸ ëª©ë¡</button>
            <button onclick="testAdminEventCreate()">ì´ë²¤íŠ¸ ìƒì„±</button>
            <button onclick="testAdminEventUpdate()">ì´ë²¤íŠ¸ ìˆ˜ì •</button>
            <button onclick="testAdminEventParticipations()">ì°¸ì—¬ì ëª©ë¡</button>
            <button onclick="testAdminEventForceClaim()">ê°•ì œ ë³´ìƒ</button>
        </div>

        <!-- ì½˜í…ì¸  ê´€ë¦¬ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ“ ì½˜í…ì¸  ê´€ë¦¬</h4>
            <button onclick="testAdminContentEvents()">ì½˜í…ì¸  ì´ë²¤íŠ¸</button>
            <button onclick="testAdminMissionTemplates()">ë¯¸ì…˜ í…œí”Œë¦¿</button>
            <button onclick="testAdminRewardCatalog()">ë¦¬ì›Œë“œ ì¹´íƒˆë¡œê·¸</button>
            <button onclick="testAdminRewardAudit()">ë¦¬ì›Œë“œ ê°ì‚¬</button>
        </div>

        <!-- ì‹œìŠ¤í…œ ê´€ë¦¬ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ”§ ì‹œìŠ¤í…œ ê´€ë¦¬</h4>
            <button onclick="testAdminStats()">ì‹œìŠ¤í…œ í†µê³„</button>
            <button onclick="testAdminAuditLogs()">ê°ì‚¬ ë¡œê·¸</button>
            <button onclick="testAdminTransactions()">ê±°ë˜ ë‚´ì—­</button>
            <button onclick="testAdminLimitedPackages()">í•œì • íŒ¨í‚¤ì§€</button>
            <button onclick="testAdminGachaConfig()">ê°€ì±  ì„¤ì •</button>
        </div>

        <div id="admin-status" class="status"></div>
        <pre id="admin-result"></pre>
    </div>

    <!-- í†µí•© ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section">
        <h3>ğŸ”„ í†µí•© ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h3>
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ’° êµ¬ë§¤-ì”ì•¡ ë™ê¸°í™”</h4>
            <button onclick="testPurchaseSync()">êµ¬ë§¤ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</button>
            <button onclick="testEventSync()">ì´ë²¤íŠ¸ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</button>
            <button onclick="runSyncIntegrationTest()">ì „ì²´ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</button>
        </div>
        
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ‘¥ ì–´ë“œë¯¼ í†µí•©</h4>
            <button onclick="runAdminIntegrationTest()">ì–´ë“œë¯¼ í†µí•© í…ŒìŠ¤íŠ¸</button>
            <button onclick="testAdminWorkflow()">ì–´ë“œë¯¼ ì›Œí¬í”Œë¡œìš°</button>
        </div>
        
        <div id="integration-status" class="status"></div>
        <pre id="integration-result"></pre>
    </div>

    <!-- í”„ë¡ íŠ¸ì—”ë“œ ì—°ê³„ í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section">
        <h3>ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ ì—°ê³„ í…ŒìŠ¤íŠ¸</h3>
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ“„ í˜ì´ì§€ ì ‘ê·¼ì„±</h4>
            <button onclick="testFrontendPages()">ëª¨ë“  í˜ì´ì§€ ì²´í¬</button>
            <button onclick="testFrontendAuth()">í”„ë¡ íŠ¸ ì¸ì¦ ì²´í¬</button>
            <button onclick="testFrontendSync()">í”„ë¡ íŠ¸ ë™ê¸°í™” ê°€ì´ë“œ</button>
            <button onclick="window.open('http://localhost:3000', '_blank')">í”„ë¡ íŠ¸ì—”ë“œ ì—´ê¸°</button>
        </div>
        
        <div id="frontend-status" class="status"></div>
        <pre id="frontend-result"></pre>
    </div>

    <!-- ì‹œìŠ¤í…œ ì „ì²´ í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section">
        <h3>ğŸ¯ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h3>
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>âš¡ ë¹ ë¥¸ ì•¡ì…˜</h4>
            <button onclick="runFullSystemTest()">ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
            <button onclick="exportResults()">ê²°ê³¼ ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="location.reload()">í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨</button>
        </div>
        
        <div id="system-status" class="status"></div>
        <pre id="system-result"></pre>
    </div>

    <!-- í†µí•© í…ŒìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section" id="integration-section">
        <h2>ğŸ”„ 5. ì‹¤ì‹œê°„ ë™ê¸°í™” & ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h2>
        
        <!-- ì‹¤ì‹œê°„ ë™ê¸°í™” -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸ“¡ ì‹¤ì‹œê°„ ë™ê¸°í™”</h4>
            <button onclick="testWebSocket()">WebSocket ì—°ê²°</button>
            <button onclick="testSyncFlow()">ë™ê¸°í™” í”Œë¡œìš° í…ŒìŠ¤íŠ¸</button>
            <button onclick="testPurchaseSync()">êµ¬ë§¤-ì”ì•¡ ë™ê¸°í™”</button>
            <button onclick="testEventSync()">ì´ë²¤íŠ¸-ë³´ìƒ ë™ê¸°í™”</button>
        </div>

        <!-- ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸš€ ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸</h4>
            <button onclick="runFullIntegrationTest()">ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</button>
            <button onclick="runAdminIntegrationTest()">ì–´ë“œë¯¼ ì „ì²´ í…ŒìŠ¤íŠ¸</button>
            <button onclick="runSyncIntegrationTest()">ë™ê¸°í™” ì „ì²´ í…ŒìŠ¤íŠ¸</button>
        </div>

        <!-- í”„ë¡ íŠ¸ì—”ë“œ í†µí•© -->
        <div style="border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px;">
            <h4>ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ í†µí•©</h4>
            <button onclick="testFrontendPages()">í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testFrontendAuth()">í”„ë¡ íŠ¸ ì¸ì¦ í”Œë¡œìš°</button>
            <button onclick="testFrontendSync()">í”„ë¡ íŠ¸ ìƒíƒœ ë™ê¸°í™”</button>
        </div>

        <div id="integration-status" class="status"></div>
        <pre id="integration-result"></pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let authToken = null;
        let adminToken = null;

        // ê²°ê³¼ í‘œì‹œ í—¬í¼
        function showResult(sectionId, success, data) {
            const statusEl = document.getElementById(`${sectionId}-status`);
            const resultEl = document.getElementById(`${sectionId}-result`);
            
            statusEl.className = `status ${success ? 'success' : 'error'}`;
            statusEl.textContent = success ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨';
            resultEl.textContent = JSON.stringify(data, null, 2);
        }

        // API í˜¸ì¶œ í—¬í¼
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const headers = { 'Content-Type': 'application/json', ...options.headers };
            
            if (authToken && !options.noAuth) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, data: { error: error.message }, status: 0 };
            }
        }

        // 1. ì¸ì¦ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testSignup() {
            const result = await apiCall('/api/auth/signup', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: document.getElementById('nickname').value,
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    invite_code: document.getElementById('invite_code').value,
                    site_id: 'casino-club',
                    phone_number: '+821012345678'
                }),
                noAuth: true
            });
            
            showResult('auth', result.success, result.data);
        }

        async function testLogin() {
            const result = await apiCall('/api/auth/login', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: document.getElementById('nickname').value,
                    password: document.getElementById('password').value
                }),
                noAuth: true
            });
            
            if (result.success && result.data.access_token) {
                authToken = result.data.access_token;
                result.data._token_stored = true;
            }
            
            showResult('auth', result.success, result.data);
        }

        // 2. ìƒì  ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testShopCatalog() {
            const result = await apiCall('/api/shop/catalog', { noAuth: true });
            showResult('shop', result.success, result.data);
        }

        async function testShopProducts() {
            const result = await apiCall('/api/shop/products', { noAuth: true });
            showResult('shop', result.success, result.data);
        }

        async function testUserBalance() {
            const result = await apiCall('/api/users/balance');
            showResult('shop', result.success, result.data);
        }

        async function testShopBuy() {
            if (!authToken) {
                showResult('shop', false, { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' });
                return;
            }

            const result = await apiCall('/api/shop/buy', {
                method: 'POST',
                body: JSON.stringify({
                    product_id: '1001',
                    amount: 100,
                    quantity: 1,
                    payment_method: 'tokens'
                })
            });
            showResult('shop', result.success, result.data);
        }

        // 3. ì´ë²¤íŠ¸/ë¯¸ì…˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testEventsList() {
            const result = await apiCall('/api/events/');
            showResult('event', result.success, result.data);
        }

        async function testMissionsList() {
            const result = await apiCall('/api/missions/');
            showResult('event', result.success, result.data);
        }

        async function testEventJoin() {
            const result = await apiCall('/api/events/join', {
                method: 'POST',
                body: JSON.stringify({ event_id: 1 })
            });
            showResult('event', result.success, result.data);
        }

        async function testMissionClaim() {
            const result = await apiCall('/api/missions/1/claim', { method: 'POST' });
            showResult('event', result.success, result.data);
        }

        // 4. ì–´ë“œë¯¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        async function testAdminLogin() {
            const result = await apiCall('/api/auth/admin/login', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: document.getElementById('admin_nickname').value,
                    password: document.getElementById('admin_password').value
                }),
                noAuth: true
            });
            
            if (result.success && result.data.access_token) {
                adminToken = result.data.access_token;
                result.data._admin_token_stored = true;
            }
            
            showResult('admin', result.success, result.data);
        }

        // ì‚¬ìš©ì ê´€ë¦¬ í…ŒìŠ¤íŠ¸
        async function testAdminUsers() {
            const result = await apiCall('/api/admin/users', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminUserCreate() {
            const result = await apiCall('/api/admin/users', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: 'test_admin_user',
                    email: 'admin_test@test.com',
                    password: 'password123',
                    site_id: 'casino-club',
                    phone_number: '+821087654321'
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminUserDetail() {
            const result = await apiCall('/api/admin/users/1', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminUserElevate() {
            const result = await apiCall('/api/admin/users/elevate', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: 'test_admin_user',
                    new_rank: 'VIP'
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminUserBan() {
            const result = await apiCall('/api/admin/users/1/ban', {
                method: 'POST',
                body: JSON.stringify({
                    reason: 'í…ŒìŠ¤íŠ¸ ì°¨ë‹¨',
                    duration_hours: 1
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminUserTokens() {
            const result = await apiCall('/api/admin/users/1/tokens/add', {
                method: 'POST',
                body: JSON.stringify({
                    amount: 1000,
                    reason: 'í…ŒìŠ¤íŠ¸ í† í° ì§€ê¸‰'
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        // ìƒì  ê´€ë¦¬ í…ŒìŠ¤íŠ¸
        async function testAdminShopProducts() {
            const result = await apiCall('/api/admin/shop/products', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminShopCreate() {
            const result = await apiCall('/api/admin/shop/products', {
                method: 'POST',
                body: JSON.stringify({
                    name: 'í…ŒìŠ¤íŠ¸ ìƒí’ˆ',
                    description: 'ì–´ë“œë¯¼ì—ì„œ ìƒì„±í•œ í…ŒìŠ¤íŠ¸ ìƒí’ˆ',
                    price: 1000,
                    category: 'test',
                    is_active: true
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminShopUpdate() {
            const result = await apiCall('/api/admin/shop/products/1', {
                method: 'PUT',
                body: JSON.stringify({
                    name: 'ìˆ˜ì •ëœ í…ŒìŠ¤íŠ¸ ìƒí’ˆ',
                    price: 1500
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminShopActivate() {
            const result = await apiCall('/api/admin/shop/products/1/activate', {
                method: 'POST',
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminShopStats() {
            const result = await apiCall('/api/admin/shop/stats', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminShopCategories() {
            const result = await apiCall('/api/admin/shop/categories', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        // ì´ë²¤íŠ¸ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
        async function testAdminEvents() {
            const result = await apiCall('/api/admin/events/', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminEventCreate() {
            const result = await apiCall('/api/admin/events/', {
                method: 'POST',
                body: JSON.stringify({
                    title: 'í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸',
                    description: 'ì–´ë“œë¯¼ì—ì„œ ìƒì„±í•œ í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸',
                    event_type: 'limited_time',
                    start_date: new Date().toISOString(),
                    end_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    rewards: { gold: 1000, exp: 500 },
                    requirements: { level: 1 }
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminEventUpdate() {
            const result = await apiCall('/api/admin/events/1', {
                method: 'PUT',
                body: JSON.stringify({
                    title: 'ìˆ˜ì •ëœ í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸',
                    description: 'ìˆ˜ì •ëœ ì„¤ëª…'
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminEventParticipations() {
            const result = await apiCall('/api/admin/events/1/participations', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminEventForceClaim() {
            const result = await apiCall('/api/admin/events/1/force-claim/1', {
                method: 'POST',
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        // ì½˜í…ì¸  ê´€ë¦¬ í…ŒìŠ¤íŠ¸
        async function testAdminContentEvents() {
            const result = await apiCall('/api/admin/content/events', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminMissionTemplates() {
            const result = await apiCall('/api/admin/content/missions/templates', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminRewardCatalog() {
            const result = await apiCall('/api/admin/content/rewards/catalog', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminRewardAudit() {
            const result = await apiCall('/api/admin/content/rewards/audit', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        // ì‹œìŠ¤í…œ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
        async function testAdminStats() {
            const result = await apiCall('/api/admin/stats', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminAuditLogs() {
            const result = await apiCall('/api/admin/audit/logs', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminTransactions() {
            const result = await apiCall('/api/admin/transactions', {
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminLimitedPackages() {
            const result = await apiCall('/api/admin/limited-packages/upsert', {
                method: 'POST',
                body: JSON.stringify({
                    package_id: 'test_limited',
                    name: 'í…ŒìŠ¤íŠ¸ í•œì • íŒ¨í‚¤ì§€',
                    price: 5000,
                    contents: { gold: 10000, gems: 100 }
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        async function testAdminGachaConfig() {
            const result = await apiCall('/api/admin/gacha/config', {
                method: 'POST',
                body: JSON.stringify({
                    rates: { common: 0.7, rare: 0.25, epic: 0.05 },
                    pity_threshold: 10
                }),
                headers: adminToken ? { 'Authorization': `Bearer ${adminToken}` } : {},
                noAuth: true
            });
            showResult('admin', result.success, result.data);
        }

        // 5. ì‹¤ì‹œê°„ ë™ê¸°í™” í…ŒìŠ¤íŠ¸
        let ws = null;

        async function testWebSocket() {
            try {
                if (ws) ws.close();
                
                ws = new WebSocket('ws://localhost:8000/ws');
                ws.onopen = () => showResult('integration', true, { message: 'WebSocket ì—°ê²°ë¨' });
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    showResult('integration', true, { type: 'message', data });
                };
                ws.onerror = (error) => showResult('integration', false, { error: 'WebSocket ì˜¤ë¥˜', details: error });
                ws.onclose = () => showResult('integration', false, { message: 'WebSocket ì—°ê²° ì¢…ë£Œ' });
            } catch (error) {
                showResult('integration', false, { error: error.message });
            }
        }

        async function testSyncFlow() {
            // 1. êµ¬ë§¤ â†’ 2. ì”ì•¡ ë™ê¸°í™” â†’ 3. ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ í™•ì¸
            const results = [];
            
            // êµ¬ë§¤ í…ŒìŠ¤íŠ¸
            const buyResult = await testShopBuy();
            results.push({ step: 'purchase', result: buyResult });
            
            // ì ì‹œ ëŒ€ê¸°
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // ì”ì•¡ ì¡°íšŒ
            const balanceResult = await testUserBalance();
            results.push({ step: 'balance_check', result: balanceResult });
            
            showResult('integration', true, { sync_flow_results: results });
        }

        async function runFullIntegrationTest() {
            const results = [];
            
            // ìˆœì°¨ì ìœ¼ë¡œ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì–´ë“œë¯¼ í¬í•¨)
            const tests = [
                { name: 'ì‚¬ìš©ì_ë¡œê·¸ì¸', fn: testLogin },
                { name: 'ì–´ë“œë¯¼_ë¡œê·¸ì¸', fn: testAdminLogin },
                { name: 'ìƒì _ì¹´íƒˆë¡œê·¸', fn: testShopCatalog },
                { name: 'ì”ì•¡_ì¡°íšŒ', fn: testUserBalance },
                { name: 'ì´ë²¤íŠ¸_ëª©ë¡', fn: testEventsList },
                { name: 'ë¯¸ì…˜_ëª©ë¡', fn: testMissionsList },
                { name: 'ì–´ë“œë¯¼_ì‚¬ìš©ìê´€ë¦¬', fn: testAdminUsers },
                { name: 'ì–´ë“œë¯¼_ìƒì ê´€ë¦¬', fn: testAdminShopProducts },
                { name: 'ì–´ë“œë¯¼_ì´ë²¤íŠ¸ê´€ë¦¬', fn: testAdminEvents },
                { name: 'ì–´ë“œë¯¼_ì‹œìŠ¤í…œí†µê³„', fn: testAdminStats }
            ];
            
            for (const test of tests) {
                try {
                    await test.fn();
                    results.push({ test: test.name, success: true });
                } catch (error) {
                    results.push({ test: test.name, success: false, error: error.message });
                }
                await new Promise(resolve => setTimeout(resolve, 1000)); // ì–´ë“œë¯¼ í…ŒìŠ¤íŠ¸ëŠ” ì¡°ê¸ˆ ë” ì—¬ìœ 
            }
            
            showResult('integration', true, { full_test_results: results });
        }

        // ì–´ë“œë¯¼ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸
        async function testAdminWorkflow() {
            if (!adminToken) {
                await testAdminLogin();
            }

            const workflow = [];
            
            // 1. ì‚¬ìš©ì ìƒì„±
            const createUser = await apiCall('/api/admin/users', {
                method: 'POST',
                body: JSON.stringify({
                    nickname: `test_user_${Date.now()}`,
                    email: `test${Date.now()}@test.com`,
                    vip_tier: 'STANDARD'
                }),
                headers: { 'Authorization': `Bearer ${adminToken}` }
            });
            workflow.push({ step: 'ì‚¬ìš©ì_ìƒì„±', result: createUser });
            
            if (createUser.success) {
                const userId = createUser.data.id;
                
                // 2. ì‚¬ìš©ì ì”ì•¡ ì¡°íšŒ
                const balance = await apiCall(`/api/admin/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${adminToken}` }
                });
                workflow.push({ step: 'ì”ì•¡_ì¡°íšŒ', result: balance });
                
                // 3. í† í° ì§€ê¸‰
                const addTokens = await apiCall(`/api/admin/users/${userId}/add-tokens`, {
                    method: 'POST',
                    body: JSON.stringify({ amount: 1000, reason: 'test_workflow' }),
                    headers: { 'Authorization': `Bearer ${adminToken}` }
                });
                workflow.push({ step: 'í† í°_ì§€ê¸‰', result: addTokens });
                
                // 4. ì´ë²¤íŠ¸ ìƒì„±
                const createEvent = await apiCall('/api/admin/events', {
                    method: 'POST',
                    body: JSON.stringify({
                        title: `Test Event ${Date.now()}`,
                        description: 'Test workflow event',
                        event_type: 'GENERAL',
                        start_date: new Date().toISOString(),
                        end_date: new Date(Date.now() + 86400000).toISOString() // 24ì‹œê°„ í›„
                    }),
                    headers: { 'Authorization': `Bearer ${adminToken}` }
                });
                workflow.push({ step: 'ì´ë²¤íŠ¸_ìƒì„±', result: createEvent });
            }
            
            showResult('integration', true, { admin_workflow: workflow });
        }

        // ì¶”ê°€ í†µí•© í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        async function testPurchaseSync() {
            if (!authToken) {
                showResult('integration', false, { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' });
                return;
            }

            const results = [];
            
            // 1. êµ¬ë§¤ ì „ ì”ì•¡ ì¡°íšŒ
            const beforeBalance = await apiCall('/api/users/balance');
            results.push({ step: 'êµ¬ë§¤_ì „_ì”ì•¡', result: beforeBalance });
            
            // 2. êµ¬ë§¤ ì‹¤í–‰
            const purchase = await apiCall('/api/shop/buy', {
                method: 'POST',
                body: JSON.stringify({
                    product_id: '1001',
                    amount: 100,
                    quantity: 1,
                    payment_method: 'tokens'
                })
            });
            results.push({ step: 'êµ¬ë§¤_ì‹¤í–‰', result: purchase });
            
            // 3. ì ì‹œ ëŒ€ê¸° í›„ ì”ì•¡ ì¬ì¡°íšŒ
            await new Promise(resolve => setTimeout(resolve, 2000));
            const afterBalance = await apiCall('/api/users/balance');
            results.push({ step: 'êµ¬ë§¤_í›„_ì”ì•¡', result: afterBalance });
            
            showResult('integration', true, { purchase_sync_results: results });
        }

        async function testEventSync() {
            if (!authToken) {
                showResult('integration', false, { error: 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤' });
                return;
            }

            const results = [];
            
            // 1. ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ
            const events = await apiCall('/api/events/');
            results.push({ step: 'ì´ë²¤íŠ¸_ëª©ë¡', result: events });
            
            // 2. ì´ë²¤íŠ¸ ì°¸ì—¬ (ìˆë‹¤ë©´)
            if (events.success && events.data.length > 0) {
                const eventId = events.data[0].id;
                const join = await apiCall('/api/events/join', {
                    method: 'POST',
                    body: JSON.stringify({ event_id: eventId })
                });
                results.push({ step: 'ì´ë²¤íŠ¸_ì°¸ì—¬', result: join });
                
                // 3. ì§„í–‰ìƒí™© ì—…ë°ì´íŠ¸
                const progress = await apiCall(`/api/events/progress/${eventId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ progress: { step1: true } })
                });
                results.push({ step: 'ì§„í–‰ìƒí™©_ì—…ë°ì´íŠ¸', result: progress });
            }
            
            showResult('integration', true, { event_sync_results: results });
        }

        async function runAdminIntegrationTest() {
            if (!adminToken) {
                await testAdminLogin();
            }
            
            const results = [];
            
            const adminTests = [
                { name: 'ì–´ë“œë¯¼_í†µê³„', fn: testAdminStats },
                { name: 'ì‚¬ìš©ì_ëª©ë¡', fn: testAdminUsers },
                { name: 'ìƒì _ê´€ë¦¬', fn: testAdminShopProducts },
                { name: 'ì´ë²¤íŠ¸_ê´€ë¦¬', fn: testAdminEvents },
                { name: 'ê°ì‚¬_ë¡œê·¸', fn: testAdminAuditLogs }
            ];
            
            for (const test of adminTests) {
                try {
                    await test.fn();
                    results.push({ test: test.name, success: true });
                } catch (error) {
                    results.push({ test: test.name, success: false, error: error.message });
                }
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            showResult('integration', true, { admin_integration_results: results });
        }

        async function runSyncIntegrationTest() {
            const results = [];
            
            // 1. WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸
            try {
                await testWebSocket();
                results.push({ test: 'WebSocket_ì—°ê²°', success: true });
            } catch (error) {
                results.push({ test: 'WebSocket_ì—°ê²°', success: false, error: error.message });
            }
            
            // 2. êµ¬ë§¤-ì”ì•¡ ë™ê¸°í™”
            try {
                await testPurchaseSync();
                results.push({ test: 'êµ¬ë§¤_ë™ê¸°í™”', success: true });
            } catch (error) {
                results.push({ test: 'êµ¬ë§¤_ë™ê¸°í™”', success: false, error: error.message });
            }
            
            // 3. ì´ë²¤íŠ¸-ë³´ìƒ ë™ê¸°í™”
            try {
                await testEventSync();
                results.push({ test: 'ì´ë²¤íŠ¸_ë™ê¸°í™”', success: true });
            } catch (error) {
                results.push({ test: 'ì´ë²¤íŠ¸_ë™ê¸°í™”', success: false, error: error.message });
            }
            
            showResult('integration', true, { sync_integration_results: results });
        }

        async function testFrontendPages() {
            const pages = [
                'http://localhost:3000',
                'http://localhost:3000/shop',
                'http://localhost:3000/events',
                'http://localhost:3000/admin',
                'http://localhost:3000/admin/shop',
                'http://localhost:3000/admin/events'
            ];
            
            const results = [];
            
            for (const page of pages) {
                try {
                    const response = await fetch(page, { method: 'HEAD' });
                    results.push({ 
                        page: page.replace('http://localhost:3000', ''), 
                        status: response.status,
                        success: response.status < 400 
                    });
                } catch (error) {
                    results.push({ 
                        page: page.replace('http://localhost:3000', ''), 
                        success: false, 
                        error: error.message 
                    });
                }
            }
            
            showResult('integration', true, { frontend_pages_results: results });
        }

        async function testFrontendAuth() {
            const results = [];
            
            // í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸ì¸ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
            try {
                const loginPage = await fetch('http://localhost:3000/login');
                results.push({ test: 'ë¡œê·¸ì¸_í˜ì´ì§€', status: loginPage.status, success: loginPage.ok });
            } catch (error) {
                results.push({ test: 'ë¡œê·¸ì¸_í˜ì´ì§€', success: false, error: error.message });
            }
            
            // ì–´ë“œë¯¼ í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸
            try {
                const adminPage = await fetch('http://localhost:3000/admin');
                results.push({ test: 'ì–´ë“œë¯¼_í˜ì´ì§€', status: adminPage.status, success: adminPage.ok });
            } catch (error) {
                results.push({ test: 'ì–´ë“œë¯¼_í˜ì´ì§€', success: false, error: error.message });
            }
            
            showResult('integration', true, { frontend_auth_results: results });
        }

        async function testFrontendSync() {
            // í”„ë¡ íŠ¸ì—”ë“œì˜ ì „ì—­ ìƒíƒœ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ëŠ” ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸
            const instructions = {
                message: 'í”„ë¡ íŠ¸ì—”ë“œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ í™•ì¸í•˜ì„¸ìš”',
                steps: [
                    '1. http://localhost:3000 ì—ì„œ F12ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬ ì—´ê¸°',
                    '2. Console íƒ­ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ ì‹¤í–‰:',
                    '   window.__GLOBAL_STORE__ (ì „ì—­ ìƒíƒœ í™•ì¸)',
                    '   localStorage.getItem("auth_token") (í† í° í™•ì¸)',
                    '3. ìƒì ì—ì„œ êµ¬ë§¤ í›„ ì”ì•¡ ë³€í™” ê´€ì°°',
                    '4. ì´ë²¤íŠ¸ ì°¸ì—¬ í›„ ìƒíƒœ ë³€í™” ê´€ì°°'
                ]
            };
            
            showResult('integration', true, instructions);
        }

        // ì´ˆê¸°í™” ì‹œ ìƒì  ì¹´íƒˆë¡œê·¸ í…ŒìŠ¤íŠ¸
        window.addEventListener('load', () => {
            testShopCatalog();
            
            // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ í—¬ìŠ¤ì²´í¬ ì‹¤í–‰
            setTimeout(() => {
                const status = document.createElement('div');
                status.innerHTML = '<h3>ğŸ¥ ìë™ í—¬ìŠ¤ì²´í¬ ê²°ê³¼</h3>';
                document.body.appendChild(status);
                
                Promise.all([
                    fetch('http://localhost:8000/health'),
                    fetch('http://localhost:3000/api/health').catch(() => ({ ok: false, statusText: 'Frontend API ì—†ìŒ' }))
                ]).then(([backend, frontend]) => {
                    status.innerHTML += `
                        <p>ë°±ì—”ë“œ: ${backend.ok ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜'} (${backend.status})</p>
                        <p>í”„ë¡ íŠ¸ì—”ë“œ: ${frontend.ok ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜'} (${frontend.statusText})</p>
                        <p>ì‹œì‘ ì‹œê°„: ${new Date().toLocaleString()}</p>
                    `;
                });
            }, 5000);
        });

        // ì¶”ê°€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function clearResults() {
            document.getElementById('results-content').innerHTML = '';
        }

        function exportResults() {
            const results = document.getElementById('results-content').innerHTML;
            const blob = new Blob([results], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test_results_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function runFullSystemTest() {
            clearResults();
            showResult('system', true, { message: 'ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', timestamp: new Date().toISOString() });
            
            const tests = [
                { name: 'í—¬ìŠ¤ì²´í¬', fn: () => testHealth() },
                { name: 'ì‚¬ìš©ì_ì¸ì¦', fn: () => testUserLogin() },
                { name: 'ì–´ë“œë¯¼_ì¸ì¦', fn: () => testAdminLogin() },
                { name: 'ìƒì _ê¸°ëŠ¥', fn: () => testShopCatalog() },
                { name: 'ì´ë²¤íŠ¸_ê¸°ëŠ¥', fn: () => testEventsList() },
                { name: 'WebSocket', fn: () => testWebSocket() },
                { name: 'êµ¬ë§¤_ë™ê¸°í™”', fn: () => testPurchaseSync() },
                { name: 'í”„ë¡ íŠ¸ì—”ë“œ_í˜ì´ì§€', fn: () => testFrontendPages() }
            ];
            
            const results = [];
            for (const test of tests) {
                try {
                    await test.fn();
                    results.push({ test: test.name, success: true, timestamp: new Date().toISOString() });
                } catch (error) {
                    results.push({ test: test.name, success: false, error: error.message, timestamp: new Date().toISOString() });
                }
                await new Promise(resolve => setTimeout(resolve, 2000)); // 2ì´ˆ ëŒ€ê¸°
            }
            
            showResult('system', true, { 
                message: 'ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 
                results: results,
                summary: {
                    total: results.length,
                    passed: results.filter(r => r.success).length,
                    failed: results.filter(r => !r.success).length
                }
            });
        }
    </script>
</body>
</html>