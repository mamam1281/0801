20250807
ðŸ“‹ í˜„ìž¬ ìƒí™© ë¶„ì„
í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ì´ìŠˆë“¤ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤:

1. ë°±ì—”ë“œ êµ¬ì¡° ë¬¸ì œ
ì¤‘ë³µ íŒŒì¼ ë‹¤ìˆ˜ ì¡´ìž¬:
ì¸ì¦ ì‹œìŠ¤í…œ: auth.py, auth_simple.py, auth_clean.py, auth_temp.py ë“±
ë©”ì¸ ì•±: main.py, main_simple.py, main_fixed.py
ì„¤ì • íŒŒì¼: config.py, config_simple.py
ê²Œìž„ ë¼ìš°í„°: games.py, games_fixed.py, games_direct.py, game_api.py, game_api_v2.py
2. API í†µí•© ë¬¸ì œ
ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œ ê°„ì˜ API ì—°ë™ì´ ì™„ì „í•˜ì§€ ì•ŠìŒ
ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡°ì˜ ì¼ê´€ì„± ë¶€ì¡±
ì¸ì¦ ì‹œìŠ¤í…œì˜ ë³µìž¡ì„±
ðŸš€ ë‹¨ê³„ë³„ í•´ê²° ë°©ì•ˆ
Phase 1: ë°±ì—”ë“œ êµ¬ì¡° ì •ë¦¬ (1-2ì¼)
1.1 ì¤‘ë³µ íŒŒì¼ ì •ë¦¬
# ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
New-Item -ItemType Directory -Force -Path "cc-webapp\backend\app\_backup_$(Get-Date -Format 'yyyyMMdd')"

# ì¤‘ë³µ íŒŒì¼ë“¤ì„ ë°±ì—… í´ë”ë¡œ ì´ë™
Move-Item -Path @(
    "cc-webapp\backend\app\main_simple.py",
    "cc-webapp\backend\app\main_fixed.py",
    "cc-webapp\backend\app\config_simple.py",
    "cc-webapp\backend\app\routers\auth_simple.py",
    "cc-webapp\backend\app\routers\auth_clean.py",
    "cc-webapp\backend\app\routers\auth_temp.py",
    "cc-webapp\backend\app\routers\games_fixed.py",
    "cc-webapp\backend\app\routers\games_direct.py",
    "cc-webapp\backend\app\routers\game_api.py"
) -Destination "cc-webapp\backend\app\_backup_$(Get-Date -Format 'yyyyMMdd')" -Force

1.2 í†µí•©ëœ ë©”ì¸ ì„¤ì • íŒŒì¼
"""í†µí•© ì„¤ì • ëª¨ë“ˆ"""
import os
from typing import Optional, List
from pydantic_settings import BaseSettings
from pydantic import Field

class Settings(BaseSettings):
    """Casino-Club F2P í†µí•© ì„¤ì •"""
    
    # ê¸°ë³¸ ì„¤ì •
    app_name: str = "Casino-Club F2P"
    app_version: str = "1.0.0"
    debug: bool = Field(default=False, env="DEBUG")
    
    # ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
    database_url: str = Field(
        default="postgresql://cc_user:cc_password@postgres:5432/cc_webapp",
        env="DATABASE_URL"
    )
    
    # JWT ì„¤ì •
    jwt_secret_key: str = Field(
        default="your-secret-key-change-in-production",
        env="JWT_SECRET_KEY"
    )
    jwt_algorithm: str = "HS256"
    jwt_access_token_expire_minutes: int = 30
    jwt_refresh_token_expire_days: int = 7
    
    # Redis ì„¤ì •
    redis_url: str = Field(
        default="redis://redis:6379/0",
        env="REDIS_URL"
    )
    
    # CORS ì„¤ì •
    cors_origins: List[str] = Field(
        default=["http://localhost:3000", "http://localhost:8000"],
        env="CORS_ORIGINS"
    )
    
    # ì´ˆëŒ€ ì½”ë“œ ì„¤ì •
    require_invite_code: bool = True
    master_invite_code: str = "CASINO2025"
    
    # ê²Œìž„ ì„¤ì •
    initial_coins: int = 1000
    initial_gems: int = 10
    daily_bonus_coins: int = 100
    
    class Config:
        env_file = ".env"
        case_sensitive = False

settings = Settings()


Phase 2: API ì—”ë“œí¬ì¸íŠ¸ í‘œì¤€í™” (2-3ì¼)
2.1 í†µí•© ë¼ìš°í„° êµ¬ì¡°
"""API v1 ë¼ìš°í„° í†µí•©"""
from fastapi import APIRouter
from app.api.v1 import auth, users, games, shop, missions, events

api_router = APIRouter(prefix="/api/v1")

# í•µì‹¬ ë¼ìš°í„° ë“±ë¡
api_router.include_router(auth.router, prefix="/auth", tags=["authentication"])
api_router.include_router(users.router, prefix="/users", tags=["users"])
api_router.include_router(games.router, prefix="/games", tags=["games"])
api_router.include_router(shop.router, prefix="/shop", tags=["shop"])
api_router.include_router(missions.router, prefix="/missions", tags=["missions"])
api_router.include_router(events.router, prefix="/events", tags=["events"])



ðŸŽ® Casino-Club F2P í”„ë¡œì íŠ¸ í†µí•© ê°œë°œ ê°€ì´ë“œ
ðŸ“‹ í˜„ìž¬ ìƒí™© ë¶„ì„
í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ì´ìŠˆë“¤ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤:

1. ë°±ì—”ë“œ êµ¬ì¡° ë¬¸ì œ
ì¤‘ë³µ íŒŒì¼ ë‹¤ìˆ˜ ì¡´ìž¬:
ì¸ì¦ ì‹œìŠ¤í…œ: auth.py, auth_simple.py, auth_clean.py, auth_temp.py ë“±
ë©”ì¸ ì•±: main.py, main_simple.py, main_fixed.py
ì„¤ì • íŒŒì¼: config.py, config_simple.py
ê²Œìž„ ë¼ìš°í„°: games.py, games_fixed.py, games_direct.py, game_api.py, game_api_v2.py
2. API í†µí•© ë¬¸ì œ
ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œ ê°„ì˜ API ì—°ë™ì´ ì™„ì „í•˜ì§€ ì•ŠìŒ
ì—”ë“œí¬ì¸íŠ¸ êµ¬ì¡°ì˜ ì¼ê´€ì„± ë¶€ì¡±
ì¸ì¦ ì‹œìŠ¤í…œì˜ ë³µìž¡ì„±
ðŸš€ ë‹¨ê³„ë³„ í•´ê²° ë°©ì•ˆ
Phase 1: ë°±ì—”ë“œ êµ¬ì¡° ì •ë¦¬ (1-2ì¼)
1.1 ì¤‘ë³µ íŒŒì¼ ì •ë¦¬
1.2 í†µí•©ëœ ë©”ì¸ ì„¤ì • íŒŒì¼

Phase 2: API ì—”ë“œí¬ì¸íŠ¸ í‘œì¤€í™” (2-3ì¼)
2.1 í†µí•© ë¼ìš°í„° êµ¬ì¡°
2.2 í‘œì¤€í™”ëœ ì¸ì¦ ì‹œìŠ¤í…œ

"""í†µí•© ì¸ì¦ API"""
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.orm import Session
from datetime import timedelta
from app.core.database import get_db
from app.core.security import create_access_token, verify_password, get_password_hash
from app.schemas.auth import LoginRequest, SignupRequest, TokenResponse
from app.models.user import User
from app.core.config import settings

router = APIRouter()

@router.post("/signup", response_model=TokenResponse)
async def signup(
    request: SignupRequest,
    db: Session = Depends(get_db)
):
    """ì´ˆëŒ€ ì½”ë“œ ê¸°ë°˜ íšŒì›ê°€ìž…"""
    # ì´ˆëŒ€ ì½”ë“œ ê²€ì¦
    if settings.require_invite_code:
        if request.invite_code != settings.master_invite_code:
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="Invalid invite code"
            )
    
    # ì¤‘ë³µ ì²´í¬
    existing_user = db.query(User).filter(
        User.nickname == request.nickname
    ).first()
    if existing_user:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="Nickname already exists"
        )
    
    # ì‚¬ìš©ìž ìƒì„±
    user = User(
        nickname=request.nickname,
        password_hash=get_password_hash(request.password),
        coins=settings.initial_coins,
        gems=settings.initial_gems
    )
    db.add(user)
    db.commit()
    db.refresh(user)
    
    # í† í° ìƒì„±
    access_token = create_access_token(
        data={"sub": str(user.id)},
        expires_delta=timedelta(minutes=settings.jwt_access_token_expire_minutes)
    )
    
    return TokenResponse(
        access_token=access_token,
        token_type="bearer",
        user_id=user.id,
        nickname=user.nickname
    )

@router.post("/login", response_model=TokenResponse)
async def login(
    request: LoginRequest,
    db: Session = Depends(get_db)
):
    """ë¡œê·¸ì¸"""
    user = db.query(User).filter(
        User.nickname == request.nickname
    ).first()
    
    if not user or not verify_password(request.password, user.password_hash):
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid credentials"
        )
    
    access_token = create_access_token(
        data={"sub": str(user.id)},
        expires_delta=timedelta(minutes=settings.jwt_access_token_expire_minutes)
    )
    
    return TokenResponse(
        access_token=access_token,
        token_type="bearer",
        user_id=user.id,
        nickname=user.nickname
    )

Phase 3: í”„ë¡ íŠ¸ì—”ë“œ API í†µí•© (2-3ì¼)
3.1 API í´ë¼ì´ì–¸íŠ¸ í†µí•©


/**
 * í†µí•© API í´ë¼ì´ì–¸íŠ¸
 */
import axios, { AxiosInstance } from 'axios';
import { getToken, removeToken } from '../auth/tokenStorage';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api/v1';

class ApiClient {
    private client: AxiosInstance;

    constructor() {
        this.client = axios.create({
            baseURL: API_BASE_URL,
            timeout: 10000,
            headers: {
                'Content-Type': 'application/json',
            },
        });

        // ìš”ì²­ ì¸í„°ì…‰í„°
        this.client.interceptors.request.use(
            (config) => {
                const token = getToken();
                if (token) {
                    config.headers.Authorization = `Bearer ${token}`;
                }
                return config;
            },
            (error) => Promise.reject(error)
        );

        // ì‘ë‹µ ì¸í„°ì…‰í„°
        this.client.interceptors.response.use(
            (response) => response,
            async (error) => {
                if (error.response?.status === 401) {
                    removeToken();
                    window.location.href = '/login';
                }
                return Promise.reject(error);
            }
        );
    }

    // ì¸ì¦ API
    async signup(nickname: string, password: string, inviteCode: string) {
        const response = await this.client.post('/auth/signup', {
            nickname,
            password,
            invite_code: inviteCode,
        });
        return response.data;
    }

    async login(nickname: string, password: string) {
        const response = await this.client.post('/auth/login', {
            nickname,
            password,
        });
        return response.data;
    }

    // ì‚¬ìš©ìž API
    async getUserProfile(userId: string) {
        const response = await this.client.get(`/users/${userId}`);
        return response.data;
    }

    // ê²Œìž„ API
    async playSlot(betAmount: number) {
        const response = await this.client.post('/games/slot/spin', {
            bet_amount: betAmount,
        });
        return response.data;
    }

    async playRPS(choice: string, betAmount: number) {
        const response = await this.client.post('/games/rps/play', {
            choice,
            bet_amount: betAmount,
        });
        return response.data;
    }

    // ìƒì  API
    async getShopItems() {
        const response = await this.client.get('/shop/items');
        return response.data;
    }

    async purchaseItem(itemId: string) {
        const response = await this.client.post(`/shop/purchase/${itemId}`);
        return response.data;
    }
}

export default new ApiClient();



Phase 4: Docker í™˜ê²½ í†µí•© (1ì¼)
4.1 í†µí•© Docker Compose ì„¤ì •


version: '3.8'

services:
  backend:
    build: 
      context: ./cc-webapp/backend
      dockerfile: Dockerfile
    container_name: cc_backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://cc_user:cc_password@postgres:5432/cc_webapp
      - REDIS_URL=redis://redis:6379/0
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:-development-secret-key}
      - DEBUG=${DEBUG:-false}
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - ./cc-webapp/backend:/app
      - ./logs/backend:/app/logs
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build:
      context: ./cc-webapp/frontend
      dockerfile: Dockerfile
    container_name: cc_frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
    depends_on:
      - backend
    volumes:
      - ./cc-webapp/frontend:/app
      - /app/node_modules
      - /app/.next

  postgres:
    image: postgres:14-alpine
    container_name: cc_postgres
    environment:
      - POSTGRES_USER=cc_user
      - POSTGRES_PASSWORD=cc_password
      - POSTGRES_DB=cc_webapp
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./database/init:/docker-entrypoint-initdb.d
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U cc_user"]
      interval: 5s
      timeout: 5s
      retries: 5

  redis:
    image: redis:7-alpine
    container_name: cc_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
  redis_data:


ðŸ“ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
Backend API í…ŒìŠ¤íŠ¸

# 1. í—¬ìŠ¤ì²´í¬
curl http://localhost:8000/health

# 2. íšŒì›ê°€ìž… í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8000/api/v1/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"nickname":"testuser","password":"test123","invite_code":"CASINO2025"}'

# 3. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"nickname":"testuser","password":"test123"}'

# 4. ê²Œìž„ API í…ŒìŠ¤íŠ¸ (í† í° í•„ìš”)
curl -X POST http://localhost:8000/api/v1/games/slot/spin \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"bet_amount":100}'


Frontend í†µí•© í…ŒìŠ¤íŠ¸
ë¡œê·¸ì¸ íŽ˜ì´ì§€ (http://localhost:3000/login)
íšŒì›ê°€ìž… í”Œë¡œìš°
ê²Œìž„ ì‹¤í–‰ (ìŠ¬ë¡¯, RPS)
ìƒì  êµ¬ë§¤
ë¯¸ì…˜/ì´ë²¤íŠ¸ í™•ì¸
ðŸ”§ ë¬¸ì œ í•´ê²° ê°€ì´ë“œ
ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
1. CORS ì˜¤ë¥˜
# backend/app/main.pyì— CORS ì„¤ì • í™•ì¸
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.cors_origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
2. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜

# PostgreSQL ì»¨í…Œì´ë„ˆ í™•ì¸
docker ps | grep postgres
docker logs cc_postgres

# ë°ì´í„°ë² ì´ìŠ¤ ì§ì ‘ ì ‘ì† í…ŒìŠ¤íŠ¸
docker exec -it cc_postgres psql -U cc_user -d cc_webapp

3. í”„ë¡ íŠ¸ì—”ë“œ API ì—°ê²° ì˜¤ë¥˜
// .env.local íŒŒì¼ í™•ì¸
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1

ðŸš€ ë‹¤ìŒ ë‹¨ê³„ ì•¡ì…˜ í”Œëžœ
ì¦‰ì‹œ ì‹¤í–‰ (Day 1)
âœ… ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„± ë° ì¤‘ë³µ íŒŒì¼ ì´ë™
âœ… í†µí•© ì„¤ì • íŒŒì¼ ìƒì„±
âœ… Docker í™˜ê²½ ìž¬ì‹œìž‘
ë‹¨ê¸° (Day 2-3)
âœ… API ì—”ë“œí¬ì¸íŠ¸ í‘œì¤€í™”
âœ… ì¸ì¦ ì‹œìŠ¤í…œ í†µí•©
âœ… í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ í†µí•©
ì¤‘ê¸° (Day 4-7)
âœ… ì „ì²´ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
âœ… ë²„ê·¸ ìˆ˜ì • ë° ìµœì í™”
âœ… ë¬¸ì„œ ì—…ë°ì´íŠ¸
ðŸ“š ì°¸ê³  ë¬¸ì„œ
CASINO_CLUB_F2P_INTEGRATION_CHECKLIST.md
PHASE1_API_INTEGRATION_TEST_REPORT.md
DATABASE_CONNECTION_GUIDE.md
ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ì§„í–‰í•˜ë©´ í˜„ìž¬ì˜ ì¤‘ë³µ íŒŒì¼ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ê¹”ë”í•œ API í†µí•© êµ¬ì¡°ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. 
ê° ë‹¨ê³„ë³„ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©°, ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ í•´ê²°í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.


---------------------------------------
ðŸ” í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„ ë° ë¬¸ì œì  ì§„ë‹¨
1. Docker í™˜ê²½ íŒŒì¼ ì¤‘ë³µ ë¬¸ì œ
í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ë‹¤ìˆ˜ì˜ Docker ê´€ë ¨ íŒŒì¼ì´ ì‚°ìž¬ë˜ì–´ ìžˆìŠµë‹ˆë‹¤:

docker-compose.yml (ë©”ì¸)
docker-compose.basic.yml
docker-compose.dev.yml  
docker-compose.prod.yml
docker-compose.staging.yml
docker-compose.override.yml
docker-compose-example.yml

ë¬¸ì œì :

ì–´ë–¤ íŒŒì¼ì´ ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ”ì§€ ë¶ˆëª…í™•
í™˜ê²½ë³„ ì„¤ì •ì´ ì¤‘ë³µë˜ê±°ë‚˜ ì¶©ëŒ ê°€ëŠ¥ì„±
ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
2. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì¤‘ë³µ
|
.env.development
.env.production
.env.staging
.env.example
.env.jules


ë¬¸ì œì :

í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬ í˜¼ëž€
ì‹¤ì œ ì‚¬ìš© íŒŒì¼ ë¶ˆëª…í™•
3. ë°±ì—”ë“œ êµ¬ì¡° ë¬¸ì œ
config_simple.pyë¥¼ ë³´ë©´:

Pydantic v1 ìŠ¤íƒ€ì¼ ì‚¬ìš© (BaseSettings)
í™˜ê²½ ë³€ìˆ˜ ì§ì ‘ ì½ê¸° (os.getenv) - Pydanticì˜ ìžë™ ë¡œë”© ë¯¸í™œìš©
4. í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ê¸°ëŠ¥ ë¶ˆì¼ì¹˜
ë¬¸ì„œ(27_async_sync_status_analysis.md)ì— ë”°ë¥´ë©´:

í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‹¤ì œ ë°±ì—”ë“œ API í˜¸ì¶œ ëˆ„ë½
ìŠ¬ë¡¯ë¨¸ì‹  ë“±ì´ ì‹œë®¬ë ˆì´ì…˜ë§Œ ë™ìž‘
5. ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ë‚œë¦½

cc-manage.ps1
docker-manage.ps1
dev-tools.ps1
diagnose-frontend.ps1
deploy-auth-fix.ps1
debug-auth-environment.ps1

ðŸ“‹ ì „ìˆ˜ ê²€ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸
Docker í™˜ê²½ ì •ë¦¬

# Docker í™˜ê²½ íŒŒì¼ ì „ìˆ˜ ê²€ì‚¬ ìŠ¤í¬ë¦½íŠ¸

Write-Host "ðŸ” Docker í™˜ê²½ íŒŒì¼ ê²€ì‚¬ ì‹œìž‘..." -ForegroundColor Cyan

# Docker Compose íŒŒì¼ ì°¾ê¸°
$dockerFiles = Get-ChildItem -Path . -Filter "docker-compose*.yml" -File
Write-Host "`nðŸ“ ë°œê²¬ëœ Docker Compose íŒŒì¼:" -ForegroundColor Yellow
$dockerFiles | ForEach-Object { 
    Write-Host "  - $($_.Name) ($(Get-Date $_.LastWriteTime -Format 'yyyy-MM-dd'))" 
}

# ì‹¤ì œ ì‚¬ìš© ì¤‘ì¸ íŒŒì¼ í™•ì¸
Write-Host "`nâœ… ê¶Œìž¥ êµ¬ì¡°:" -ForegroundColor Green
Write-Host "  - docker-compose.yml (ê¸°ë³¸)"
Write-Host "  - docker-compose.override.yml (ê°œë°œ ì˜¤ë²„ë¼ì´ë“œ)"
Write-Host "  - docker-compose.prod.yml (í”„ë¡œë•ì…˜)"

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ê²€ì‚¬
$envFiles = Get-ChildItem -Path . -Filter ".env*" -File
Write-Host "`nðŸ“ ë°œê²¬ëœ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼:" -ForegroundColor Yellow
$envFiles | ForEach-Object { 
    Write-Host "  - $($_.Name)"
}

# ë°±ì—”ë“œ êµ¬ì¡° ê²€ì‚¬
Write-Host "`nðŸ” ë°±ì—”ë“œ êµ¬ì¡° ê²€ì‚¬..." -ForegroundColor Cyan
$backendPath = "cc-webapp/backend/app"
if (Test-Path $backendPath) {
    $backendStructure = @{
        "routers" = (Get-ChildItem "$backendPath/routers" -Filter "*.py" 2>$null).Count
        "services" = (Get-ChildItem "$backendPath/services" -Filter "*.py" 2>$null).Count
        "models" = (Get-ChildItem "$backendPath/models" -Filter "*.py" 2>$null).Count
        "schemas" = (Get-ChildItem "$backendPath/schemas" -Filter "*.py" 2>$null).Count
    }
    
    Write-Host "ë°±ì—”ë“œ ëª¨ë“ˆ ìˆ˜:"
    $backendStructure.GetEnumerator() | ForEach-Object {
        Write-Host "  - $($_.Key): $($_.Value) íŒŒì¼"
    }
}

# í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡° ê²€ì‚¬
Write-Host "`nðŸ” í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡° ê²€ì‚¬..." -ForegroundColor Cyan
$frontendPath = "cc-webapp/frontend"
if (Test-Path $frontendPath) {
    $frontendStructure = @{
        "app pages" = (Get-ChildItem "$frontendPath/app" -Filter "*.tsx" -Recurse 2>$null).Count
        "components" = (Get-ChildItem "$frontendPath/components" -Filter "*.tsx" -Recurse 2>$null).Count
        "API calls" = (Select-String -Path "$frontendPath/**/*.tsx","$frontendPath/**/*.ts" -Pattern "fetch|axios|apiClient" -Recurse 2>$null).Count
    }
    
    Write-Host "í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°:"
    $frontendStructure.GetEnumerator() | ForEach-Object {
        Write-Host "  - $($_.Key): $($_.Value)"
    }
}



í†µí•© Docker Compose ì„¤ì •

# ë©”ì¸ Docker Compose ì„¤ì • (í†µí•© ë²„ì „)
version: '3.8'

services:
  backend:
    build:
      context: ./cc-webapp/backend
      dockerfile: Dockerfile
    container_name: cc_backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://cc_user:cc_password@postgres:5432/cc_webapp
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET_KEY=${JWT_SECRET_KEY:-dev-secret-key}
    depends_on:
      - postgres
      - redis
    volumes:
      - ./cc-webapp/backend:/app
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  frontend:
    build:
      context: ./cc-webapp/frontend
      dockerfile: Dockerfile
    container_name: cc_frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8000
    depends_on:
      - backend
    volumes:
      - ./cc-webapp/frontend:/app
      - /app/node_modules
      - /app/.next

  postgres:
    image: postgres:14-alpine
    container_name: cc_postgres
    environment:
      - POSTGRES_USER=cc_user
      - POSTGRES_PASSWORD=cc_password
      - POSTGRES_DB=cc_webapp
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    container_name: cc_redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:


  ë°±ì—”ë“œ Config ê°œì„ 


# ê°œì„ ëœ ì„¤ì • ëª¨ë“ˆ
from pydantic_settings import BaseSettings, SettingsConfigDict
from typing import Optional
from functools import lru_cache

class Settings(BaseSettings):
    """ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • (Pydantic v2)"""
    model_config = SettingsConfigDict(
        env_file=".env",
        env_file_encoding="utf-8",
        case_sensitive=False
    )
    
    # Database
    database_url: str = "postgresql://cc_user:cc_password@localhost:5432/cc_webapp"
    
    # Redis
    redis_url: str = "redis://localhost:6379"
    
    # JWT
    jwt_secret_key: str = "super-secret-key-for-development-only"
    jwt_algorithm: str = "HS256"
    jwt_access_token_expire_minutes: int = 30
    
    # API
    api_version: str = "0.1.0"
    debug: bool = False
    
    # Admin
    default_admin_username: str = "admin"
    default_admin_password: str = "admin"
    
    # CORS
    cors_origins: list[str] = ["http://localhost:3000"]

@lru_cache()
def get_settings() -> Settings:
    """ì„¤ì • ì‹±ê¸€í†¤ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜"""
    return Settings()

settings = get_settings()


í”„ë¡ íŠ¸ì—”ë“œ API ì—°ê²° ê²€ì¦
// API í´ë¼ì´ì–¸íŠ¸ í†µí•©
import axios from 'axios';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
  withCredentials: true,
});

// í† í° ì¸í„°ì…‰í„°
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// ì—ëŸ¬ ì¸í„°ì…‰í„°
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // í† í° ë§Œë£Œ ì²˜ë¦¬
      localStorage.removeItem('access_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// API ì—”ë“œí¬ì¸íŠ¸
export const api = {
  // ê²Œìž„ API
  games: {
    slotSpin: (betAmount: number) => 
      apiClient.post('/api/games/slot/spin', { bet_amount: betAmount }),
    rouletteSpin: (betType: string, betValue: any) => 
      apiClient.post('/api/games/roulette/spin', { bet_type: betType, bet_value: betValue }),
    gachaPull: (pullType: string) => 
      apiClient.post('/api/games/gacha/pull', { pull_type: pullType }),
  },
  
  // ìœ ì € API
  users: {
    getProfile: () => apiClient.get('/api/users/profile'),
    updateProfile: (data: any) => apiClient.patch('/api/users/profile', data),
  },
  
  // í† í° API
  tokens: {
    getBalance: () => apiClient.get('/api/tokens/balance'),
    purchase: (amount: number) => apiClient.post('/api/tokens/purchase', { amount }),
  },
};


í™˜ê²½ í†µí•© ìŠ¤í¬ë¦½íŠ¸

# í™˜ê²½ ì •ë¦¬ ë° í†µí•© ìŠ¤í¬ë¦½íŠ¸

Write-Host "ðŸ§¹ í”„ë¡œì íŠ¸ í™˜ê²½ ì •ë¦¬ ì‹œìž‘..." -ForegroundColor Green

# 1. ë¶ˆí•„ìš”í•œ Docker Compose íŒŒì¼ ë°±ì—…
$backupDir = "backups/docker-configs-$(Get-Date -Format 'yyyyMMdd')"
New-Item -ItemType Directory -Path $backupDir -Force | Out-Null

@("docker-compose.basic.yml", "docker-compose-example.yml") | ForEach-Object {
    if (Test-Path $_) {
        Move-Item $_ "$backupDir/" -Force
        Write-Host "  âœ… $_ ë°±ì—… ì™„ë£Œ" -ForegroundColor Yellow
    }
}

# 2. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì •ë¦¬
Write-Host "`nðŸ“ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í†µí•©..." -ForegroundColor Cyan

# .env.developmentë¥¼ ê¸°ë³¸ .envë¡œ
if (Test-Path ".env.development") {
    Copy-Item ".env.development" ".env" -Force
    Write-Host "  âœ… .env íŒŒì¼ ìƒì„± ì™„ë£Œ" -ForegroundColor Green
}

# 3. í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ì—°ê²° í™•ì¸
Write-Host "`nðŸ”— API ì—°ê²° ìƒíƒœ í™•ì¸..." -ForegroundColor Cyan

# Docker ì„œë¹„ìŠ¤ ì‹œìž‘
docker-compose up -d postgres redis
Start-Sleep -Seconds 5

# ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸
$backendHealth = Invoke-RestMethod -Uri "http://localhost:8000/health" -Method Get -ErrorAction SilentlyContinue
if ($backendHealth) {
    Write-Host "  âœ… ë°±ì—”ë“œ API ì •ìƒ" -ForegroundColor Green
} else {
    Write-Host "  âŒ ë°±ì—”ë“œ API ì‘ë‹µ ì—†ìŒ" -ForegroundColor Red
}

# 4. í†µí•© ë³´ê³ ì„œ ìƒì„±
$report = @"
# í™˜ê²½ í†µí•© ë³´ê³ ì„œ
ìƒì„±ì¼: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')

## Docker í™˜ê²½
- ë©”ì¸ íŒŒì¼: docker-compose.yml
- ê°œë°œ ì˜¤ë²„ë¼ì´ë“œ: docker-compose.override.yml
- í”„ë¡œë•ì…˜: docker-compose.prod.yml

## í™˜ê²½ ë³€ìˆ˜
- ê°œë°œ: .env (ê¸°ë³¸)
- í”„ë¡œë•ì…˜: .env.production
- ì˜ˆì œ: .env.example

## ì„œë¹„ìŠ¤ ìƒíƒœ
- Backend: http://localhost:8000
- Frontend: http://localhost:3000
- PostgreSQL: localhost:5432
- Redis: localhost:6379

## ë‹¤ìŒ ë‹¨ê³„
1. docker-compose up -d ì‹¤í–‰
2. http://localhost:3000 ì ‘ì† í™•ì¸
3. API ì—°ë™ í…ŒìŠ¤íŠ¸
"@

$report | Out-File "INTEGRATION_REPORT.md" -Encoding UTF8
Write-Host "`nðŸ“Š í†µí•© ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ: INTEGRATION_REPORT.md" -ForegroundColor Green


 ì¦‰ì‹œ ì‹¤í–‰ í•„ìš” ìž‘ì—…
Docker í™˜ê²½ ì •ë¦¬: ë¶ˆí•„ìš”í•œ docker-compose íŒŒì¼ ì œê±°/ë°±ì—…
í™˜ê²½ ë³€ìˆ˜ í†µí•©: .env íŒŒì¼ í•˜ë‚˜ë¡œ í†µì¼
ë°±ì—”ë“œ Config ì—…ë°ì´íŠ¸: Pydantic v2ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸: í†µí•© API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
í…ŒìŠ¤íŠ¸: ì „ì²´ ì‹œìŠ¤í…œ ì—°ë™ í…ŒìŠ¤íŠ¸

# ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì§‘ (null/ë¹ˆ ë¬¸ìžì—´ ì²´í¬ ì¶”ê°€)
Get-ChildItem "cc-webapp/backend/app/routers" -Filter "*.py" -Recurse 2>$null | ForEach-Object {
    $content = Get-Content $_.FullName -Raw
    if (![string]::IsNullOrWhiteSpace($content)) {
        $matches = [regex]::Matches($content, '@router\.(get|post|put|delete|patch)\("([^"]+)"\)')
        foreach($match in $matches) {
            $backendEndpoints += $match.Groups[2].Value    
        }
    }
}

# í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ ìˆ˜ì§‘ (null/ë¹ˆ ë¬¸ìžì—´ ì²´í¬ ì¶”ê°€)
Get-ChildItem "cc-webapp/frontend" -Include "*.ts","*.tsx","*.js","*.jsx" -Recurse 2>$null | ForEach-Object {
    $content = Get-Content $_.FullName -Raw
    if (![string]::IsNullOrWhiteSpace($content)) {
        $matches = [regex]::Matches($content, '(fetch|apiClient\.|axios\.)(get|post|put|delete|patch)?\([\'"`]([^\'"`]+)[\'"`]')
        foreach($match in $matches) {
            $frontendAPICalls += $match.Groups[3].Value    
        }
    }
}


