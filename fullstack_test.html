<!DOCTYPE html>
<html>
<head>
    <title>Casino-Club í’€ìŠ¤íƒ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #000; color: #0ff; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #0ff; border-radius: 5px; }
        .success { background: #001100; border-color: #0f0; color: #0f0; }
        .error { background: #110000; border-color: #f00; color: #f00; }
        .info { background: #001111; border-color: #0ff; color: #0ff; }
        button { background: #0ff; color: #000; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; }
        button:hover { background: #fff; }
        pre { background: #111; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° Casino-Club í’€ìŠ¤íƒ ì „ì—­ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h1>
        <div id="status" class="test-result info">ì‹œì‘ ëŒ€ê¸° ì¤‘...</div>
        <div id="results"></div>
        
        <button onclick="testFullStack()">ğŸš€ í’€ìŠ¤íƒ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
        <button onclick="checkCurrentState()">ğŸ” í˜„ì¬ ìƒíƒœ í™•ì¸</button>
        <button onclick="testGameAPI()">ğŸ® ê²Œì„ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearStorage()">ğŸ—‘ï¸ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            document.getElementById('results').appendChild(div);
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `test-result ${type}`;
            status.innerHTML = message;
        }

        async function testFullStack() {
            updateStatus('ğŸ”„ í’€ìŠ¤íƒ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                // 1. ë°±ì—”ë“œ ì§ì ‘ ë¡œê·¸ì¸
                log('1ï¸âƒ£ ë°±ì—”ë“œ API ì§ì ‘ ë¡œê·¸ì¸ ì‹œë„...');
                
                const response = await fetch('http://localhost:8000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        site_id: 'admin',
                        password: '123456'
                    })
                });
                
                log(`ì‘ë‹µ ìƒíƒœ: ${response.status}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    log(`âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${errorText}`, 'error');
                    updateStatus('âŒ ë°±ì—”ë“œ ë¡œê·¸ì¸ ì‹¤íŒ¨', 'error');
                    return;
                }
                
                const loginData = await response.json();
                log(`âœ… ë°±ì—”ë“œ ë¡œê·¸ì¸ ì„±ê³µ!`, 'success');
                log(`ì‚¬ìš©ì ì •ë³´: ${JSON.stringify(loginData.user, null, 2)}`);
                log(`Gold Balance: ${loginData.user.gold_balance}`);
                
                // 2. í† í° ì €ì¥
                log('2ï¸âƒ£ í† í° ì €ì¥...');
                const tokens = {
                    access_token: loginData.access_token,
                    refresh_token: loginData.refresh_token || loginData.access_token
                };
                
                localStorage.setItem('cc_auth_tokens', JSON.stringify(tokens));
                log('âœ… í† í° localStorageì— ì €ì¥ ì™„ë£Œ', 'success');
                
                // 3. í”„ë¡œí•„ API í…ŒìŠ¤íŠ¸
                log('3ï¸âƒ£ ì¸ì¦ëœ í”„ë¡œí•„ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸...');
                const profileResponse = await fetch('http://localhost:8000/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${loginData.access_token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (profileResponse.ok) {
                    const profileData = await profileResponse.json();
                    log(`âœ… í”„ë¡œí•„ API ì„±ê³µ: ${JSON.stringify(profileData, null, 2)}`, 'success');
                } else {
                    log(`âŒ í”„ë¡œí•„ API ì‹¤íŒ¨: ${profileResponse.status}`, 'error');
                }
                
                // 4. ì”ì•¡ API í…ŒìŠ¤íŠ¸
                log('4ï¸âƒ£ ì”ì•¡ API í…ŒìŠ¤íŠ¸...');
                const balanceResponse = await fetch('http://localhost:8000/api/users/balance', {
                    headers: {
                        'Authorization': `Bearer ${loginData.access_token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (balanceResponse.ok) {
                    const balanceData = await balanceResponse.json();
                    log(`âœ… ì”ì•¡ API ì„±ê³µ: ${JSON.stringify(balanceData, null, 2)}`, 'success');
                } else {
                    log(`âŒ ì”ì•¡ API ì‹¤íŒ¨: ${balanceResponse.status}`, 'error');
                }
                
                updateStatus('ğŸ‰ í’€ìŠ¤íƒ í…ŒìŠ¤íŠ¸ ì™„ë£Œ! ìƒˆë¡œê³ ì¹¨í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œ ë™ê¸°í™” í™•ì¸', 'success');
                
                // 5. ìë™ ìƒˆë¡œê³ ì¹¨ ì˜µì…˜
                setTimeout(() => {
                    if (confirm('í”„ë¡ íŠ¸ì—”ë“œ ì „ì—­ë™ê¸°í™” í™•ì¸ì„ ìœ„í•´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        window.location.reload();
                    }
                }, 2000);
                
            } catch (error) {
                log(`ğŸ’¥ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                updateStatus('ğŸ’¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨', 'error');
            }
        }

        async function checkCurrentState() {
            log('ğŸ” í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸...');
            
            const tokens = localStorage.getItem('cc_auth_tokens');
            if (tokens) {
                const parsed = JSON.parse(tokens);
                log(`âœ… ì €ì¥ëœ í† í° ì¡´ì¬: ${JSON.stringify(parsed, null, 2)}`, 'success');
                
                // í† í°ìœ¼ë¡œ í”„ë¡œí•„ í™•ì¸
                try {
                    const response = await fetch('http://localhost:8000/api/auth/me', {
                        headers: {
                            'Authorization': `Bearer ${parsed.access_token}`,
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        log(`âœ… í˜„ì¬ ë¡œê·¸ì¸ ìƒíƒœ: ${JSON.stringify(data, null, 2)}`, 'success');
                    } else {
                        log(`âŒ í† í° ìœ íš¨í•˜ì§€ ì•ŠìŒ: ${response.status}`, 'error');
                    }
                } catch (e) {
                    log(`âŒ í† í° ê²€ì¦ ì˜¤ë¥˜: ${e.message}`, 'error');
                }
            } else {
                log('âŒ ì €ì¥ëœ í† í° ì—†ìŒ', 'error');
            }
        }

        async function testGameAPI() {
            log('ğŸ® ê²Œì„ API í…ŒìŠ¤íŠ¸...');
            
            const tokens = localStorage.getItem('cc_auth_tokens');
            if (!tokens) {
                log('âŒ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const parsed = JSON.parse(tokens);
            
            try {
                // ìŠ¬ë¡¯ ê²Œì„ API í…ŒìŠ¤íŠ¸
                const response = await fetch('http://localhost:8000/api/games/slots/spin', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${parsed.access_token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        bet_amount: 10
                    })
                });
                
                if (response.ok) {
                    const gameResult = await response.json();
                    log(`ğŸ° ìŠ¬ë¡¯ ê²Œì„ ê²°ê³¼: ${JSON.stringify(gameResult, null, 2)}`, 'success');
                } else {
                    log(`âŒ ê²Œì„ API ì‹¤íŒ¨: ${response.status}`, 'error');
                }
            } catch (e) {
                log(`âŒ ê²Œì„ API ì˜¤ë¥˜: ${e.message}`, 'error');
            }
        }

        function clearStorage() {
            localStorage.removeItem('cc_auth_tokens');
            sessionStorage.clear();
            log('ğŸ—‘ï¸ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì™„ë£Œ', 'info');
            updateStatus('ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ë¨', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ìƒíƒœ í™•ì¸
        window.onload = function() {
            updateStatus('ì¤€ë¹„ ì™„ë£Œ - í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”', 'info');
            checkCurrentState();
        };
    </script>
</body>
</html>
