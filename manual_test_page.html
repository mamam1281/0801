<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ° Casino-Club F2P - ìˆ˜ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        h1 { text-align: center; margin-bottom: 30px; }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; transform: none; }
        #results {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: rgba(46, 213, 115, 0.3); }
        .error { background: rgba(231, 76, 60, 0.3); }
        .info { background: rgba(52, 152, 219, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° Casino-Club F2P í†µí•© í…ŒìŠ¤íŠ¸</h1>
        
        <div class="section">
            <h2>ğŸ” ì¸ì¦ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testLogout()">ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸</button>
            <div id="authStatus" class="status info">ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒ</div>
        </div>

        <div class="section">
            <h2>ğŸ›’ ìƒì  êµ¬ë§¤ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testShopPurchase()" id="purchaseBtn" disabled>ìƒì  êµ¬ë§¤ í…ŒìŠ¤íŠ¸</button>
            <button onclick="getShopItems()">ìƒì  ì•„ì´í…œ ì¡°íšŒ</button>
            <div id="shopStatus" class="status info">ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥</div>
        </div>

        <div class="section">
            <h2>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ í…ŒìŠ¤íŠ¸</h2>
            <button onclick="testBackendHealth()">ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬</button>
            <button onclick="testFrontendHealth()">í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ í™•ì¸</button>
            <button onclick="testAllAPIs()">ì „ì²´ API í…ŒìŠ¤íŠ¸</button>
        </div>

        <div class="section">
            <h2>ğŸ“ í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
            <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
            <pre id="results">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...</pre>
        </div>
    </div>

    <script>
        let authToken = null;
        let userId = null;

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            results.textContent += logEntry;
            results.scrollTop = results.scrollHeight;
            
            console.log(message);
        }

        function updateAuthStatus(loggedIn, user = null) {
            const authStatus = document.getElementById('authStatus');
            const shopStatus = document.getElementById('shopStatus');
            const purchaseBtn = document.getElementById('purchaseBtn');
            
            if (loggedIn) {
                authStatus.textContent = `ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì¸ (User ID: ${user?.id || userId})`;
                authStatus.className = 'status success';
                shopStatus.textContent = 'ìƒì  ì´ìš© ê°€ëŠ¥';
                shopStatus.className = 'status success';
                purchaseBtn.disabled = false;
            } else {
                authStatus.textContent = 'ì¸ì¦ ìƒíƒœ: ë¡œê·¸ì•„ì›ƒ';
                authStatus.className = 'status info';
                shopStatus.textContent = 'ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥';
                shopStatus.className = 'status info';
                purchaseBtn.disabled = true;
            }
        }

        async function testLogin() {
            log('ğŸ” ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const response = await fetch('http://localhost:8000/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        site_id: 'user001',
                        password: '123455'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    userId = data.user.id;
                    
                    log(`âœ… ë¡œê·¸ì¸ ì„±ê³µ! User ID: ${userId}`);
                    log(`ğŸ« Access Token: ${authToken.substring(0, 50)}...`);
                    updateAuthStatus(true, data.user);
                } else {
                    const error = await response.json();
                    log(`âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${response.status} - ${JSON.stringify(error)}`);
                    updateAuthStatus(false);
                }
            } catch (error) {
                log(`âŒ ë¡œê·¸ì¸ ì˜¤ë¥˜: ${error.message}`);
                updateAuthStatus(false);
            }
        }

        async function testLogout() {
            log('ğŸšª ë¡œê·¸ì•„ì›ƒ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            authToken = null;
            userId = null;
            updateAuthStatus(false);
            log('âœ… ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
        }

        async function testShopPurchase() {
            if (!authToken) {
                log('âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            log('ğŸ›’ ìƒì  êµ¬ë§¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            try {
                const purchaseData = {
                    user_id: userId,
                    product_id: 'test_product_' + Math.random().toString(36).substr(2, 8),
                    amount: 1000,
                    quantity: 1,
                    kind: 'item',
                    payment_method: 'tokens'
                };

                log(`ğŸ“¦ êµ¬ë§¤ ìš”ì²­: ${JSON.stringify(purchaseData, null, 2)}`);

                const response = await fetch('http://localhost:8000/api/shop/buy', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(purchaseData)
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… êµ¬ë§¤ ì„±ê³µ! ${JSON.stringify(data, null, 2)}`);
                    
                    const shopStatus = document.getElementById('shopStatus');
                    shopStatus.textContent = `âœ… ìµœê·¼ êµ¬ë§¤: ${data.product_id}`;
                    shopStatus.className = 'status success';
                } else {
                    const error = await response.json();
                    log(`âŒ êµ¬ë§¤ ì‹¤íŒ¨: ${response.status} - ${JSON.stringify(error)}`);
                }
            } catch (error) {
                log(`âŒ êµ¬ë§¤ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        async function getShopItems() {
            log('ğŸª ìƒì  ì•„ì´í…œ ì¡°íšŒ ì¤‘...');
            
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const response = await fetch('http://localhost:8000/api/shop/products', {
                    method: 'GET',
                    headers
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ìƒì  ì•„ì´í…œ ì¡°íšŒ ì„±ê³µ: ${data.length || 0}ê°œ ì•„ì´í…œ`);
                    if (data.length > 0) {
                        log(`ğŸ“‹ ì²« ë²ˆì§¸ ì•„ì´í…œ: ${JSON.stringify(data[0], null, 2)}`);
                    }
                } else {
                    log(`âš ï¸ ìƒì  ì¡°íšŒ ì‘ë‹µ: ${response.status}`);
                }
            } catch (error) {
                log(`âŒ ìƒì  ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        async function testBackendHealth() {
            log('ğŸ¥ ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬ ì¤‘...');
            
            try {
                const response = await fetch('http://localhost:8000/health');
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ë°±ì—”ë“œ ì •ìƒ: ${JSON.stringify(data, null, 2)}`);
                } else {
                    log(`âŒ ë°±ì—”ë“œ ì˜¤ë¥˜: ${response.status}`);
                }
            } catch (error) {
                log(`âŒ ë°±ì—”ë“œ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
            }
        }

        async function testFrontendHealth() {
            log('ğŸŒ í”„ë¡ íŠ¸ì—”ë“œ ìƒíƒœ í™•ì¸ ì¤‘...');
            
            try {
                const response = await fetch('http://localhost:3000/health');
                if (response.ok) {
                    log(`âœ… í”„ë¡ íŠ¸ì—”ë“œ ì •ìƒ: ${response.status}`);
                } else {
                    log(`âš ï¸ í”„ë¡ íŠ¸ì—”ë“œ ì‘ë‹µ: ${response.status}`);
                }
            } catch (error) {
                log(`âŒ í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
            }
        }

        async function testAllAPIs() {
            log('ğŸš€ ì „ì²´ API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            log('=' * 50);
            
            await testBackendHealth();
            await testFrontendHealth();
            
            if (!authToken) {
                await testLogin();
            }
            
            if (authToken) {
                await getShopItems();
                await testShopPurchase();
            }
            
            log('ğŸ¯ ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
            log('=' * 50);
        }

        function clearResults() {
            document.getElementById('results').textContent = 'í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤...';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í—¬ìŠ¤ì²´í¬
        window.onload = function() {
            log('ğŸ° Casino-Club F2P í…ŒìŠ¤íŠ¸ ë„êµ¬ ë¡œë“œë¨');
            log('ğŸ’¡ ë¸Œë¼ìš°ì €ì—ì„œ CORS ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ --disable-web-security ì˜µì…˜ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”');
            testBackendHealth();
        };
    </script>
</body>
</html>