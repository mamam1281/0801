## (2025-08-16) ì„¸ì…˜ & í† í° ì‹¤ì‹œê°„ ê¸°ëŠ¥ ì—…ë°ì´íŠ¸
- GameSession í…Œì´ë¸”(Alembic 20250816_add_game_sessions_table) ë„ì…: int PK + external_session_id(UUID) unique, ì¸ë±ìŠ¤(user_id+status, user_id+game_type, start_time, created_at)
- /api/games/session/start,end ì˜ì†í™”: í™œì„± ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_rounds/total_bet/total_win ê¸°ë¡
- /api/games/session/active ì¶”ê°€, GameHistory SESSION_START/END ë¡œê¹…
- WebSocket: game_session ì´ë²¤íŠ¸( start/end ) í™•ì¥ + token_update ì´ë²¤íŠ¸(TokenService add/deduct hook)
- í–¥í›„ í™•ì¥ ì˜ˆì •: token_updateì— history_id, balance_coin/gem ì„¸ë¶„í™”, ì„¸ì…˜ ë¼ìš´ë“œ ìë™ ëˆ„ì  ë° ROI

### ê²€ì¦ (ê³„íš/ìˆ˜í–‰)
- [ ] alembic upgrade head í›„ game_sessions ì¡´ì¬ ë° ì¸ë±ìŠ¤ í™•ì¸(ix_game_sessions_*)
- [ ] pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  ì¼€ì´ìŠ¤ í†µê³¼
- [ ] WebSocket ìˆ˜ë™ ìŠ¤ëª¨í¬: startâ†’end íë¦„ ë©”ì‹œì§€ 2ì¢… + í† í° ë³€ê²½ ì‹œ token_update

### ë‹¤ìŒ ë‹¨ê³„
1. í…ŒìŠ¤íŠ¸ êµ¬í˜„ ë° ì‹¤í–‰ ê²°ê³¼ ë°˜ì˜
2. token_update payload êµ¬ì¡° í™•ì¥(history_id, gem/coin êµ¬ë¶„)
3. ì„¸ì…˜ ë‚´ ë² íŒ…/ìŠ¹ë¦¬ ìë™ ëˆ„ì ê³¼ ì„¸ì…˜ KPI(ROI, í‰ê·  ë¼ìš´ë“œ ê¸¸ì´) ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„

## ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²€ì¦ ë°©ë²•
ê° í•­ëª©ì˜ ì²´í¬ ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
- âœ… ì™„ë£Œ: ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ê³ , í…ŒìŠ¤íŠ¸ë˜ì—ˆìœ¼ë©°, ë¬¸ì„œí™”ë¨
- âš ï¸ í…ŒìŠ¤íŠ¸ í•„ìš”: êµ¬í˜„ì€ ì™„ë£Œë˜ì—ˆìœ¼ë‚˜ í…ŒìŠ¤íŠ¸ ë° ë¬¸ì„œí™”/ ê°œì„ ì´ í•„ìš”í•¨. ë¶€ë¶„ì™„ë£Œ
- âŒ ë¯¸ì™„ë£Œ: ì•„ì§ ì‹œì‘ë˜ì§€ ì•ŠìŒ

## ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] ìƒí’ˆ ì¹´íƒˆë¡œê·¸ ê´€ë¦¬: SKU/ì´ë¦„/ê°€ê²©/ì ¬/í• ì¸/í•„ìš” ë“±ê¸‰ ë…¸ì¶œ
- [âœ…] ê²© ì •ì±… ë° í• ì¸ ì‹œìŠ¤í…œ: ğŸ·ï¸ í• ì¸ìœ¨ ë° â±ï¸ ì¢…ë£Œì‹œê°ì— ë”°ë¼ ğŸ§® ì´ì•¡ ê³„ì‚°
- [âœ…] êµ¬ë§¤ ì „ ê²€ì¦(ìê²©): VIP ì „ìš© ìƒí’ˆì— ì¼ë°˜ ì‚¬ìš©ìê°€ ì ‘ê·¼ ì‹œ 403
- [âœ…] ê²°ì œ ê²Œì´íŠ¸ì›¨ì´ ì—°ë™: authorize ì‹¤íŒ¨/ì„±ê³µ, capture ì‹¤íŒ¨/ì„±ê³µ ì²˜ë¦¬
- [âœ…] ë³´ìƒ ì§€ê¸‰: cyber_token_balance ì¦ì•¡
- [âœ…] ê±°ë˜ ë¡œê·¸: UserAction(action_type=SHOP_BUY) ë° charge_id ê¸°ë¡

### ì¶”ê°€ ì²´í¬ë¦¬ìŠ¤íŠ¸ â€” ê²°ì œ/ì˜ì†/ë¬¸ì„œ/ê´€ì¸¡/í…ŒìŠ¤íŠ¸ (2025-08-15)
- [âœ…] ë©±ë“±ì„±/ê²°ì œ ì•ˆì •ì„±
  - [âœ…] êµ¬ë§¤ API idempotency_key ì§€ì›(ì¤‘ë³µ ê²°ì œ ë°©ì§€, ì¬ì‹œë„ ì•ˆì „)
  - [âœ…] Redis í‚¤ TTL ì„¤ê³„ ë° ì›ìì  ì¬ê³  ê°ì†Œ(try_reserveâ†’finalize/timeout release)
- [âœ…] ì´ë ¥/ì˜ì†í™”
  - [âœ…] DB ìŠ¤í‚¤ë§ˆ ì •ì‹í™”(Alembic): íŒ¨í‚¤ì§€/ì¬ê³ /êµ¬ë§¤/í”„ë¡œëª¨ ì‚¬ìš© ë¡œê·¸ í…Œì´ë¸”
  - [âœ…] ê´€ë¦¬ì ê°ì‚¬ ë¡œê·¸(ëˆ„ê°€/ì–¸ì œ/ë¬´ì—‡ì„) í‘œì¤€í™” (+ ì¸ë±ìŠ¤ ix_admin_audit_action_created)
- [âœ…] ê³„ì•½/ë¬¸ì„œí™”
  - [âœ…] Admin/Shop ìƒ˜í”Œ ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œ ì¶”ê°€
  - [âœ…] reason ì½”ë“œ í‘œì¤€ ê³µê°œ(OUT_OF_STOCK, DISABLED, WINDOW_CLOSED, USER_LIMIT, PROMO_EXHAUSTED ë“±)
  - [âœ…] í”„ëŸ°íŠ¸ ì—°ë™ ê°€ì´ë“œ(í”„ë¡œëª¨ ì…ë ¥, ë¹„í™œì„±/ê¸°ê°„ì™¸/ì¬ê³ ì—†ìŒ UI ì²˜ë¦¬ ê¸°ì¤€)
- [ ] ê´€ì¸¡ì„±/ë¶„ì„
  - [ ] Kafka êµ¬ë§¤ ì´ë²¤íŠ¸ â†’ ClickHouse ì ì¬ íŒŒì´í”„ë¼ì¸ ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸
  -  1 ì¬ê³ /êµ¬ë§¤ìœ¨/í”„ë¡œëª¨ ì‚¬ìš©ë¥  ëŒ€ì‹œë³´ë“œ ì´ˆì•ˆ(Grafana/Metabase)
- [âœ…] í…ŒìŠ¤íŠ¸ ë³´ê°•
  - [âœ…] ë™ì‹œ êµ¬ë§¤ ê²½í•© ì‹œë‚˜ë¦¬ì˜¤
  - [âœ…] ì˜ˆì•½ ì·¨ì†Œ(ì˜ˆì•½â†’íƒ€ì„ì•„ì›ƒ) ì¼€ì´ìŠ¤
  - [âš ï¸] í”„ë¡œëª¨ ì†Œì§„ ê²½ê³„ê°’


### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


### (2025-08-16) ë³€ê²½ ìš”ì•½ / ì„¸ì…˜ & ì‹¤ì‹œê°„ í† í°
#### ë³€ê²½ ìš”ì•½
- GameSession í…Œì´ë¸” ì¶”ê°€(Alembic: 20250816_add_game_sessions_table) ë° ì¸ë±ìŠ¤.
- /api/games/session/start,end ì˜ì†í™” (ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_* ì—…ë°ì´íŠ¸) + /session/active.
- GameHistory SESSION_START/END ë¡œê¹….
- WebSocket: game_session ì´ë²¤íŠ¸ í™•ì¥(external_session_id í¬í•¨) + token_update ì´ë²¤íŠ¸ ì‹ ì„¤(TokenService hook).

#### ê²€ì¦ ê²°ê³¼
- ì½”ë“œ ê¸°ì¤€ ë¼ìš°í„° ì¤‘ë³µ ì œê±°, ëª¨ë¸ í•„ë“œ ì •í•©ì„±(ì™¸ë¶€ UUID â†” ë‚´ë¶€ int PK) í™•ë³´.
- token_service ê²½ë¡œ add/deduct ì‹œ ë¹„ë™ê¸° token_update ë¸Œë¡œë“œìºìŠ¤íŠ¸ íŠ¸ë¦¬ê±°(ë£¨í”„ ì¡´ì¬ ì‹œ).
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ heads ë‹¨ì¼ì„±/ì¸ë±ìŠ¤ ì ìš© í•„ìš” (alembic upgrade head ì˜ˆì •).

#### ë‹¤ìŒ ë‹¨ê³„
1. pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸.
2. token_update payload balance_coin/gem ë¶„ë¦¬ ë° history_id í¬í•¨ ì—¬ë¶€ í™•ì¥ ê²€í† .
3. ì„¸ì…˜ ë‚´ ë¼ìš´ë“œë³„ BET/WIN ìë™ ëˆ„ì  ë° ROI/ë¦¬ë”ë³´ë“œ í›„ì†.

### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


### (2025-08-16) ë³€ê²½ ìš”ì•½ / ì„¸ì…˜ & ì‹¤ì‹œê°„ í† í°
#### ë³€ê²½ ìš”ì•½
- GameSession í…Œì´ë¸” ì¶”ê°€(Alembic: 20250816_add_game_sessions_table) ë° ì¸ë±ìŠ¤.
- /api/games/session/start,end ì˜ì†í™” (ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_* ì—…ë°ì´íŠ¸) + /session/active.
- GameHistory SESSION_START/END ë¡œê¹….
- WebSocket: game_session ì´ë²¤íŠ¸ í™•ì¥(external_session_id í¬í•¨) + token_update ì´ë²¤íŠ¸ ì‹ ì„¤(TokenService hook).

#### ê²€ì¦ ê²°ê³¼
- ì½”ë“œ ê¸°ì¤€ ë¼ìš°í„° ì¤‘ë³µ ì œê±°, ëª¨ë¸ í•„ë“œ ì •í•©ì„±(ì™¸ë¶€ UUID â†” ë‚´ë¶€ int PK) í™•ë³´.
- token_service ê²½ë¡œ add/deduct ì‹œ ë¹„ë™ê¸° token_update ë¸Œë¡œë“œìºìŠ¤íŠ¸ íŠ¸ë¦¬ê±°(ë£¨í”„ ì¡´ì¬ ì‹œ).
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ heads ë‹¨ì¼ì„±/ì¸ë±ìŠ¤ ì ìš© í•„ìš” (alembic upgrade head ì˜ˆì •).

#### ë‹¤ìŒ ë‹¨ê³„
1. pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸.
2. token_update payload balance_coin/gem ë¶„ë¦¬ ë° history_id í¬í•¨ ì—¬ë¶€ í™•ì¥ ê²€í† .
3. ì„¸ì…˜ ë‚´ ë¼ìš´ë“œë³„ BET/WIN ìë™ ëˆ„ì  ë° ROI/ë¦¬ë”ë³´ë“œ í›„ì†.

### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


### (2025-08-16) ë³€ê²½ ìš”ì•½ / ì„¸ì…˜ & ì‹¤ì‹œê°„ í† í°
#### ë³€ê²½ ìš”ì•½
- GameSession í…Œì´ë¸” ì¶”ê°€(Alembic: 20250816_add_game_sessions_table) ë° ì¸ë±ìŠ¤.
- /api/games/session/start,end ì˜ì†í™” (ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_* ì—…ë°ì´íŠ¸) + /session/active.
- GameHistory SESSION_START/END ë¡œê¹….
- WebSocket: game_session ì´ë²¤íŠ¸ í™•ì¥(external_session_id í¬í•¨) + token_update ì´ë²¤íŠ¸ ì‹ ì„¤(TokenService hook).

#### ê²€ì¦ ê²°ê³¼
- ì½”ë“œ ê¸°ì¤€ ë¼ìš°í„° ì¤‘ë³µ ì œê±°, ëª¨ë¸ í•„ë“œ ì •í•©ì„±(ì™¸ë¶€ UUID â†” ë‚´ë¶€ int PK) í™•ë³´.
- token_service ê²½ë¡œ add/deduct ì‹œ ë¹„ë™ê¸° token_update ë¸Œë¡œë“œìºìŠ¤íŠ¸ íŠ¸ë¦¬ê±°(ë£¨í”„ ì¡´ì¬ ì‹œ).
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ heads ë‹¨ì¼ì„±/ì¸ë±ìŠ¤ ì ìš© í•„ìš” (alembic upgrade head ì˜ˆì •).

#### ë‹¤ìŒ ë‹¨ê³„
1. pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸.
2. token_update payload balance_coin/gem ë¶„ë¦¬ ë° history_id í¬í•¨ ì—¬ë¶€ í™•ì¥ ê²€í† .
3. ì„¸ì…˜ ë‚´ ë¼ìš´ë“œë³„ BET/WIN ìë™ ëˆ„ì  ë° ROI/ë¦¬ë”ë³´ë“œ í›„ì†.

### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


### (2025-08-16) ë³€ê²½ ìš”ì•½ / ì„¸ì…˜ & ì‹¤ì‹œê°„ í† í°
#### ë³€ê²½ ìš”ì•½
- GameSession í…Œì´ë¸” ì¶”ê°€(Alembic: 20250816_add_game_sessions_table) ë° ì¸ë±ìŠ¤.
- /api/games/session/start,end ì˜ì†í™” (ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_* ì—…ë°ì´íŠ¸) + /session/active.
- GameHistory SESSION_START/END ë¡œê¹….
- WebSocket: game_session ì´ë²¤íŠ¸ í™•ì¥(external_session_id í¬í•¨) + token_update ì´ë²¤íŠ¸ ì‹ ì„¤(TokenService hook).

#### ê²€ì¦ ê²°ê³¼
- ì½”ë“œ ê¸°ì¤€ ë¼ìš°í„° ì¤‘ë³µ ì œê±°, ëª¨ë¸ í•„ë“œ ì •í•©ì„±(ì™¸ë¶€ UUID â†” ë‚´ë¶€ int PK) í™•ë³´.
- token_service ê²½ë¡œ add/deduct ì‹œ ë¹„ë™ê¸° token_update ë¸Œë¡œë“œìºìŠ¤íŠ¸ íŠ¸ë¦¬ê±°(ë£¨í”„ ì¡´ì¬ ì‹œ).
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ heads ë‹¨ì¼ì„±/ì¸ë±ìŠ¤ ì ìš© í•„ìš” (alembic upgrade head ì˜ˆì •).

#### ë‹¤ìŒ ë‹¨ê³„
1. pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸.
2. token_update payload balance_coin/gem ë¶„ë¦¬ ë° history_id í¬í•¨ ì—¬ë¶€ í™•ì¥ ê²€í† .
3. ì„¸ì…˜ ë‚´ ë¼ìš´ë“œë³„ BET/WIN ìë™ ëˆ„ì  ë° ROI/ë¦¬ë”ë³´ë“œ í›„ì†.

### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


### (2025-08-16) ë³€ê²½ ìš”ì•½ / ì„¸ì…˜ & ì‹¤ì‹œê°„ í† í°
#### ë³€ê²½ ìš”ì•½
- GameSession í…Œì´ë¸” ì¶”ê°€(Alembic: 20250816_add_game_sessions_table) ë° ì¸ë±ìŠ¤.
- /api/games/session/start,end ì˜ì†í™” (ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_* ì—…ë°ì´íŠ¸) + /session/active.
- GameHistory SESSION_START/END ë¡œê¹….
- WebSocket: game_session ì´ë²¤íŠ¸ í™•ì¥(external_session_id í¬í•¨) + token_update ì´ë²¤íŠ¸ ì‹ ì„¤(TokenService hook).

#### ê²€ì¦ ê²°ê³¼
- ì½”ë“œ ê¸°ì¤€ ë¼ìš°í„° ì¤‘ë³µ ì œê±°, ëª¨ë¸ í•„ë“œ ì •í•©ì„±(ì™¸ë¶€ UUID â†” ë‚´ë¶€ int PK) í™•ë³´.
- token_service ê²½ë¡œ add/deduct ì‹œ ë¹„ë™ê¸° token_update ë¸Œë¡œë“œìºìŠ¤íŠ¸ íŠ¸ë¦¬ê±°(ë£¨í”„ ì¡´ì¬ ì‹œ).
- ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ í›„ heads ë‹¨ì¼ì„±/ì¸ë±ìŠ¤ ì ìš© í•„ìš” (alembic upgrade head ì˜ˆì •).

#### ë‹¤ìŒ ë‹¨ê³„
1. pytest: ì„¸ì…˜ ì‹œì‘/ì¤‘ë³µ/ì¢…ë£Œ/active/token_update ì´ë²¤íŠ¸ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸.
2. token_update payload balance_coin/gem ë¶„ë¦¬ ë° history_id í¬í•¨ ì—¬ë¶€ í™•ì¥ ê²€í† .
3. ì„¸ì…˜ ë‚´ ë¼ìš´ë“œë³„ BET/WIN ìë™ ëˆ„ì  ë° ROI/ë¦¬ë”ë³´ë“œ í›„ì†.

### ì§„í–‰ìƒí™© ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] **Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²°** (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- [âœ…] ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) í•´ê²°
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì •ë¦¬ ë° ì´ˆê¸°í™”
- [âœ…] ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ê²€ì¦

- [âœ…] **ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘** (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- [âœ…] PostgreSQL í™˜ê²½ì—ì„œ ë¡¤ë°± í…ŒìŠ¤íŠ¸ (downgrade -1 â†’ upgrade ì™•ë³µ ì„±ê³µ)
- [âœ…] SQLite ì œì•½ì¡°ê±´ ìš°íšŒ ë°©ì•ˆ (ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€, í…Œì´ë¸” recreate/ë°±ì—… ê¶Œì¥)
- [âœ…] ì•ˆì „í•œ ë¡¤ë°± ì „ëµ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´**
- [âœ…] ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸ ê²€ì¦ (alembic current/head ë‹¨ì¼, history ì ê²€)
- [âœ…] FK/ì œì•½ì¡°ê±´ ìˆœì„œ ì •ë¦¬ (ì¼ë¶€ ì ê²€ í•„ìš”)
- [âœ…] ì˜ì¡´ì„± ê·¸ë˜í”„ ë¬¸ì„œí™” (ì´ˆì•ˆ ì¶”ê°€ ì•„ë˜ ì°¸ê³ )

- [âœ…] **ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬** ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- [âœ…] .env.test ìƒì„± (í…ŒìŠ¤íŠ¸ DB/ì‹œí¬ë¦¿ ë¶„ë¦¬)
- [âœ…] docker-compose.test.ymlë¡œ í…ŒìŠ¤íŠ¸ DB ê²©ë¦¬ ê¸°ë™ ê²€ì¦
- [âœ…] CIì—ì„œ .env.test ì‚¬ìš©í•˜ì—¬ alembic+pytest ì‹¤í–‰ (GitHub Actions ì¶”ê°€)

- [âœ…] **Kafka/Zookeeper ì»¨í…Œì´ë„ˆ ì •ìƒ ê¸°ë™** 
- (docker-compose, ë„¤íŠ¸ì›Œí¬, í¬íŠ¸, ë„¤ì„ ì¶©ëŒ í•´ê²°)
- [âš ï¸] **FastAPI Kafka ì—°ë™** (aiokafka/kafka-python ì—°ê²° ì„¤ì •, 
- ì‹¤ì œ Producer/Consumer ì—°ë™) â€” Producer OK, Consumer pending
- ì†Œë¹„ì ì´ˆê¸°í™” ê°œì„ : íŒŒí‹°ì…˜ assignment ëŒ€ê¸° í›„ seek-to-beginning ì ìš© ë©”ì‹œì§€ ìœ ì‹¤ ë°©ì§€), 
  pytest ì‹¤í–‰ ì‹œ thread ê¸°ë°˜ ì†Œë¹„ì ê°•ì œ ë° ê³ ìœ  consumer group ì‚¬ìš©
- í”„ë¡œë“€ì„œ ì „ì†¡ í™•ì¸: ë™ê¸° ì „ì†¡(future.get) ë° ë©”íƒ€ë°ì´í„° ë¡œê·¸(topic/partition/offset) ì¶œë ¥ ì¶”ê°€
- [âœ…] **Kafka ì—°ë™ ìë™í™” í…ŒìŠ¤íŠ¸/ë¬¸ì„œí™”** (pytest í†µí•© í…ŒìŠ¤íŠ¸, ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ë¶„ë¦¬)

### ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸
- [âœ…] backend/requirements.txtì— aiokafka(or kafka-python) ì¶”ê°€ (kafka-python/aiokafka ì´ë¯¸ í¬í•¨)
- [âœ…] ì„¤ì •: app.core.config.settingsì— Kafka ì„¤ì • í‚¤ ì •ì˜ (KAFKA_BOOTSTRAP_SERVERS, KAFKA_ENABLED)
- [âœ…] ì„œë¹„ìŠ¤: KafkaProducer/KafkaConsumer ë˜í¼ ëª¨ë“ˆ 1ê°œë§Œ ì‚¬ìš© (app/kafka_client.py ì¬ì‚¬ìš©)
- [âœ…] ì—”ë“œí¬ì¸íŠ¸: /api/kafka/produce, /api/kafka/health ì¶”ê°€ (app/routers/kafka_api.py)
- [âœ…] pytest í†µí•© í…ŒìŠ¤íŠ¸: ë¸Œë¡œì»¤ ì—†ìœ¼ë©´ skip (app/tests/test_kafka_integration.py)
- [âœ…] ë¼ìš´ë“œíŠ¸ë¦½ í…ŒìŠ¤íŠ¸ ì¶”ê°€(app/tests/test_kafka_roundtrip.py): TestClient ê¸°ë°˜ìœ¼ë¡œ /api/kafka/produce ì „ì†¡ í›„ /api/kafka/_debug/last í´ë§ë¡œ í™•ì¸(í˜„ì¬ í™˜ê²½ì—ì„œ ê°„í— ë¯¸ê²€ì¶œ â†’ ì†Œë¹„ì ì´ˆê¸°í™” ë¡œì§ ê°œì„  ì ìš©)


### 1. ë°±ì—”ë“œ (Backend)
#### í•µì‹¬ ì¸í”„ë¼
- [âœ…] FastAPI í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° êµ¬ì¡°í™” (routers, services, repositories, schemas/models)
- ì²´í¬ ë°©ë²•: ì»¨í…Œì´ë„ˆì—ì„œ ì„œë²„ ê¸°ë™ ì‹œ /docs ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë…¸ì¶œ í™•ì¸
- ê²€ì¦ ê¸°ì¤€: í”„ë¡œì íŠ¸ êµ¬ì¡°ê°€ Clean Architecture ì›ì¹™ì„ ë”°ë¦„
- ì²´í¬ ëŒ€ìƒ: (ê²€ì¦ ê²°ê³¼)
- [âœ…] í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (routers/, services/, repositories/, schemas/, models/ ë“±) ì¡´ì¬
- [âœ…] main.py ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ì¡´ì¬ ë° ë¼ìš°í„° í¬í•¨/ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- [âœ…] config.py (app/core/config.py)ì™€ docker-compose(.env.test í¬í•¨)ë¡œ í™˜ê²½ ì„¤ì • ì¼ì›í™”
- [âœ…] middleware ì„¤ì • (SimpleLoggingMiddleware, CORS) ì ìš©, ì»¤ìŠ¤í…€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ëŠ” ë³´ë¥˜
- [âœ…] ì˜ì¡´ì„± ì£¼ì… ì„¤ì • (get_db ë“± DI íŒ¨í„´ ì‚¬ìš© ê°€ëŠ¥; ë¼ìš°í„°ì—ì„œ Depends í™œìš©)
- [âœ…] API ë¬¸ì„œí™” ì„¤ì • (Swagger /docs, /redoc ê²½ë¡œ í™œì„±)
- [âœ…] PostgreSQL ì—°ë™ ë° SQLAlchemy ORM ì„¤ì • (êµ¬ì¡°/ì—°ê²°/ì„¸ì…˜/ì—”ì§„ ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic upgrade head ì‹¤í–‰ ë° DB ì—°ê²° í…ŒìŠ¤íŠ¸
- ê²€ì¦ ê¸°ì¤€: ëª¨ë¸ CRUD ì‘ì—…ì´ ì˜¤ë¥˜ ì—†ì´ ìˆ˜í–‰ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] database.py ì„¤ì • íŒŒì¼ (ì—”ì§„/ì„¸ì…˜, Postgres/SQLite fallback)
- [âœ…] SQLAlchemy Base ë° SessionLocal ê´€ë¦¬ (app.database.Base)
- [âœ…] í™˜ê²½ ë³€ìˆ˜: POSTGRES_* / DATABASE_URL ì§€ì› (compose.testì—ì„œ ì£¼ì…)
- [âœ…] ì—°ê²° ì˜µì…˜/echo ì„¤ì • ë° ì—°ê²° ì„±ê³µ ë¡œê·¸ ì¶œë ¥
- [âœ…] íŠ¸ëœì­ì…˜ ìŠ¤ì½”í”„(get_db DI) ì œê³µ
- [âœ…] ê¸°ë³¸ ëª¨ë¸ í´ë˜ìŠ¤ëŠ” ê° ëª¨ë¸ ëª¨ë“ˆì—ì„œ Base ìƒì†ìœ¼ë¡œ ì¼ê´€ ì‚¬ìš©
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨


- [âœ…] Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ êµ¬ì„± ë° ì ìš© (êµ¬ì„±/ê²½ë¡œ/ìŠ¤í¬ë¦½íŠ¸/ë©”íƒ€ë°ì´í„°ì—°ë™ì •ìƒ)
- ì²´í¬ ë°©ë²•: alembic revision --autogenerate ëª…ë ¹ìœ¼ë¡œ ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
- ê²€ì¦ ê¸°ì¤€: í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] alembic.ini ì„¤ì • íŒŒì¼ ì¡´ì¬
- [âœ…] migrations(versions/) êµ¬ì„± ë° ë¦¬ë¹„ì „ ë‹¤ìˆ˜ ì¡´ì¬, ë‹¨ì¼ head ìœ ì§€
- [âœ…] env.py: app.models.Base ë©”íƒ€ë°ì´í„° ì‚¬ìš©, POSTGRES_* í™˜ê²½ì—ì„œ URLêµ¬ì„±
- [âœ…] ì´ˆê¸°/í›„ì† ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬(merge í¬í•¨) ë° ìˆœì„œ ì •í•©
- [âœ…] ë¡¤ë°± ì§€ì›: Postgresì—ì„œ downgrade/upgrade ì™•ë³µ ê²€ì¦ ì™„ë£Œ(ë¡œê·¸ì°¸ì¡°), 
  - SQLite ì œí•œì€ ë¬¸ì„œí™”
- [âœ…] ì˜ì¡´ì„± ìˆœì„œ ì ê²€ ë° mergeë¡œ ë‹¨ì¼ head ìœ ì§€(f79d04ea1016 ì´í›„ head=20250810_align_users)
  -  alembic upgrade head ì‹œ ê¸°ì¡´ í…Œì´ë¸” ì¤‘ë³µ(OperationalError) ì¶©ëŒ í•´ê²°: ìë™ í…Œì´ë¸” ì •ë¦¬ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì™„ë£Œ
  - íŒŒì¼ëª…: backend/scripts/reset_db_and_alembic.sh
  - ëª¨ë“  í…Œì´ë¸” ì‚­ì œ, ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±/ì ìš© ìë™í™”
  - ì‹¤í–‰ ì „ ë°˜ë“œì‹œ DB ë°±ì—… í•„ìˆ˜
  - ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ alembic upgrade head ì •ìƒ ë™ì‘ í™•ì¸ë¨
  - [ì°¸ê³ ] SQLite í™˜ê²½ì—ì„œ ë¡¤ë°±(downgrade) ë¶ˆê°€(OperationalError: NOT NULL ì»¬ëŸ¼ ì¶”ê°€ ë¶ˆê°€) â†’ ê°œë°œ í™˜ê²½ì—ì„œëŠ” recreate/ë°±ì—… ì „ëµ ë³‘í–‰ í•„ìš”
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´ì¸/ì˜ì¡´ì„± ìˆœì„œëŠ” ì •ìƒì´ë‚˜, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì‹œ DBMSë³„ ì œì•½(íŠ¹íˆ SQLite)ë¡œ ì¼ë¶€ ë¡¤ë°± ë¶ˆê°€
  - [âœ…] ìš´ì˜ DB(PostgreSQL) ì‹¤ì „ ê²€ì¦ ì™„ë£Œ: ë§ˆì´ê·¸ë ˆì´ì…˜/ë¡¤ë°±/ì˜ì¡´ì„± ìˆœì„œ ì •ìƒ ë™ì‘ í™•ì¸(í…ŒìŠ¤íŠ¸ ìŠ¤íƒ ê¸°ì¤€)


### DB ì¸í”„ë¼ ê°œì„ /ì •í•©ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸

- âœ… Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ í•´ê²° (í…Œì´ë¸” ì¤‘ë³µ, ì»¬ëŸ¼ ì¶©ëŒ ë“±)
- âœ… ë¡¤ë°±/ë‹¤ìš´ê·¸ë ˆì´ë“œ ì •ìƒ ë™ì‘ (ìš´ì˜/í…ŒìŠ¤íŠ¸ í™˜ê²½ ëª¨ë‘)
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ì¡´ì„±/ìˆœì„œ ì •í•©ì„± í™•ë³´
- âœ… ìš´ì˜/í…ŒìŠ¤íŠ¸ DB í™˜ê²½ ë¶„ë¦¬ ë° .env/ì»¨í…Œì´ë„ˆ ë¶„ë¦¬
- âŒ ì£¼ìš” í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½ì¡°ê±´ ì„¤ê³„ í™•ì •
- âœ… íŠ¸ëœì­ì…˜/ì›ìì„±/ì •í•©ì„± í…ŒìŠ¤íŠ¸
- âœ… ë°ì´í„° ì •í•©ì„± ê²€ì¦(ìƒ˜í”Œ ë°ì´í„°, CRUD, FK ë“±) â€” ê¸°ë³¸ CRUD/FK ìŠ¤ëª¨í¬ í†µê³¼
- âš ï¸ ë°±ì—…/ë³µêµ¬ ì „ëµ ìˆ˜ë¦½ ë° í…ŒìŠ¤íŠ¸
- ë©”ëª¨: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ë¤í”„/ë³µêµ¬ ìŠ¤ë‹ˆí«
- ë°±ì—…: `docker exec cc_postgres pg_dump -U cc_user -d cc_webapp > backup_cc_webapp_$(Get-Date -Format yyyyMMddHHmmss).sql`
- ë³µêµ¬(ì£¼ì˜: ë°ì´í„° ì‚­ì œ): `docker exec -i cc_postgres psql -U cc_user -d cc_webapp < backup.sql`
- âœ… ë§ˆì´ê·¸ë ˆì´ì…˜/ì •í•©ì„± ìë™í™” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± â€” CI Alembic history + downgrade(-1)/upgrade head ì¶”ê°€
- âœ… ê°œì„ /ì´ìŠˆ/í•´ê²°ë‚´ì—­ ë¬¸ì„œí™”
- âœ… Kafka ì—°ë™ (ì´ë²¤íŠ¸/ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬) â€” ìµœì†Œ ì—°ê²°/ë¼ìš´ë“œíŠ¸ë¦½(í”¼í¬) ìŠ¤ëª¨í¬ ì™„ë£Œ
- ì²´í¬ ë°©ë²•: Producer/Consumer í…ŒìŠ¤íŠ¸, ë©”ì‹œì§€ ë°œí–‰/êµ¬ë… í™•ì¸
- ê²€ì¦ ê¸°ì¤€: ë©”ì‹œì§€ ì†ì‹¤ ì—†ì´ ì „ë‹¬ë˜ëŠ”ì§€ í™•ì¸
- ì²´í¬ ëŒ€ìƒ:
- âœ… Kafka ì—°ê²° ì„¤ì •
- âœ… í† í”½ ì •ì˜ ë° ìƒì„± â€” auto-create + CI KAFKA_TEST_TOPIC=cc_test_ci
- âœ… Producer êµ¬í˜„ (ì‚¬ìš©ì í–‰ë™, ë³´ìƒ ì´ë²¤íŠ¸ ë“±)
- âœ… Consumer ê·¸ë£¹ ì„¤ì • â€” ê³ ìœ  consumer group/pytest ê²©ë¦¬
- âœ… ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ë©”ì»¤ë‹ˆì¦˜
- âŒ ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™ (í•„ìš”ì‹œ)

### ë‹¤ìŒ ë‹¨ê³„(2025-08-11)
- [âœ…] app/tests/test_invite_validate_api.py ì‘ì„± ë° í†µê³¼: ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬ ì½”ë“œ ì¼€ì´ìŠ¤ + ì‘ë‹µ í¬ë§· ê²€ì¦
- [âœ…] InviteCode ëª¨ë¸â†”DB ìŠ¤í‚¤ë§ˆ ì •í•©ì„± ì •ë¦¬: expires_at/max_uses/used_count/created_by í•„ë“œ í†µì¼, Alembic ë³´ê°•
- [âœ…] ë¼ìš°í„° ìµœì†Œ ë“±ê¸‰ ì˜ì¡´ì„±(require_min_rank) êµ¬í˜„ ë° ë°ëª¨ ì—”ë“œí¬ì¸íŠ¸ ì ìš©(+403/200 í…ŒìŠ¤íŠ¸)
- [âš ï¸] ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸(ps1) ë° ê°„ë‹¨ Runbook ì„¹ì…˜ ì¶”ê°€

- [âŒ] JWT ì¸ì¦ ë° ê¶Œí•œ ê´€ë¦¬ (ì´ˆëŒ€ì½”ë“œ/ë‹‰ë„¤ì„ ê¸°ë°˜, VIP/ë“±ê¸‰ë³„ ì ‘ê·¼ì œì–´)
  - ì²´í¬ ë°©ë²•: í† í° ë°œê¸‰/ê²€ì¦ í…ŒìŠ¤íŠ¸, ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì¸ì¦ í—¤ë” ì—†ì´ ì ‘ê·¼ ì‹œ 401, ê¶Œí•œ ì—†ëŠ” ê²½ìš° 403 ë°˜í™˜
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] JWT ì¸ì½”ë”©/ë””ì½”ë”© ê¸°ëŠ¥ (AuthService.create_access_token/verify_token êµ¬í˜„, í…ŒìŠ¤íŠ¸ í†µê³¼)
- [âœ…] í† í° ë°œê¸‰ ì—”ë“œí¬ì¸íŠ¸ (/api/auth/signup, /api/auth/login, /api/auth/admin/login)
- [âœ…] ë§Œë£Œ ì‹œê°„ ì„¤ì • (JWT_EXPIRE_MINUTES í™˜ê²½ë³€ìˆ˜, ê¸°ë³¸ 30ë¶„)
- [âœ…] í† í° ë¦¬í”„ë ˆì‹œ ë©”ì»¤ë‹ˆì¦˜ (/api/auth/refresh, Authorization Bearer í˜¹ì€ body.refresh_token í—ˆìš©)
- [âœ…] ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´ (RBAC) â€” require_min_rank ì˜ì¡´ì„± ë° /api/rbac/premium, /api/rbac/vip ë°ëª¨ë¡œ ê²€ì¦
- [âœ…] VIP/PREMIUM/STANDARD ë“±ê¸‰ë³„ ê¶Œí•œ â€” ì„œë¹„ìŠ¤ì˜ check_rank_access ì ìš© ë° í…ŒìŠ¤íŠ¸ ë³´ê°• ì™„ë£Œ

### ë‹¤ìŒ ë‹¨ê³„(ì¶”ê°€ â€” 2025-08-15)
- [âœ…] Redis í‚¤ ì „ëµ/ë©±ë“±í‚¤ ì„¤ê³„ ë°˜ì˜(êµ¬ë§¤ API/ì„œë¹„ìŠ¤ ë ˆë²¨)
- [âœ…] DB ìŠ¤í‚¤ë§ˆ ë„ì¶œ ë° Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ˆì•ˆ ì‘ì„±(í…Œì´ë¸”/ì¸ë±ìŠ¤/ì œì•½) *(ê¸°ì¡´ 20250813/20250815 ë¦¬ë¹„ì „ ì§‘í•© í™œìš© â€“ ì‹ ê·œ ì´ˆì•ˆ ë¶ˆí•„ìš” íŒë‹¨)*
- [âœ…] ë¬¸ì„œ ë³´ê°•: Admin/Shop ì˜ˆì‹œ í˜ì´ë¡œë“œ/ì‘ë‹µ ë° reason ì½”ë“œ í‘œ ì¶”ê°€, FE ì—°ë™ ê°€ì´ë“œ ì—…ë°ì´íŠ¸


- [âŒ] í…ŒìŠ¤íŠ¸ ì½”ë“œ(Pytest) ë° ì—ëŸ¬/ë¡œê¹…/ë¬¸ì„œí™”
  - ì²´í¬ ë°©ë²•: pytest -v ì‹¤í–‰, ì½”ë“œ ì»¤ë²„ë¦¬ì§€ í™•ì¸
  - ê²€ì¦ ê¸°ì¤€: í•µì‹¬ ê¸°ëŠ¥ 80% ì´ìƒ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€, ì˜ˆì™¸ ì²˜ë¦¬ ë¬¸ì„œí™”
  - ì²´í¬ ëŒ€ìƒ:
- [âŒ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬)
- [âŒ] í†µí•© í…ŒìŠ¤íŠ¸ (API ì—”ë“œí¬ì¸íŠ¸)
- [âŒ] ë¡œê¹… ì„¤ì • (êµ¬ì¡°í™”ëœ ë¡œê·¸)
- [âŒ] ì—ëŸ¬ í•¸ë“¤ë§ ë¯¸ë“¤ì›¨ì–´
- [âŒ] ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ í´ë˜ìŠ¤
- [âŒ] API ë¬¸ì„œí™” (OpenAPI/Swagger)


### ì‚¬ìš©ì ì—¬ì • 1: ì§„ì… ë° ë“±ë¡
- [âœ…] ì´ˆëŒ€ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ API (/api/invite/validate)
  - ì²´í¬ ë°©ë²•: ìœ íš¨/ë§Œë£Œ/ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¡œ API í˜¸ì¶œ 
  - ê²€ì¦ ê¸°ì¤€: ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œì™€ ì‘ë‹µ ë©”ì‹œì§€ ë°˜í™˜ 
  - ì²´í¬ ëŒ€ìƒ: ì½”ë“œëŠ” ê³ ì •ê°’ 5858 âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ - ë¬´í•œì¬ì‚¬ìš© êµ¬í˜„ë¨
- [âœ…] ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ â€” ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤(ìœ íš¨/ë§Œë£Œ/ì‚¬ìš©ì´ˆê³¼/ë¯¸ì¡´ì¬) í…ŒìŠ¤íŠ¸ë¡œ ê²€ì¦
- [âœ…] ë§Œë£Œ ì‹œê°„ ê²€ì‚¬ â€” expires_at ê¸°ì¤€ ë¹„êµë¡œ ë™ì‘ í™•ì¸
- [âœ…] ì‚¬ìš© íšŸìˆ˜ ì œí•œ ê²€ì‚¬ â€” None=ë¬´ì œí•œ, ì •ìˆ˜=ë‚¨ì€íšŸìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
- [âš ï¸] ì½”ë“œ ë³´ì•ˆ (ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„±) â€” DEFAULT_INVITE_CODE ë‚œìˆ˜í™” ê¶Œì¥(ìš´ì˜ ì‹œ ê³ ì •ê°’ ê¸ˆì§€)
- [âœ…] ì‘ë‹µ í¬ë§· (is_valid/error_message/code/expires_at/remaining_uses) â€” OpenAPIì™€ ì¼ì¹˜ ê²€ì¦
- ë©”ëª¨(2025-08-11): pytest.iniê°€ app/testsë§Œ ì¸ì‹í•˜ë¯€ë¡œ backend/tests í•˜ ì´ˆëŒ€ì½”ë“œ í…ŒìŠ¤íŠ¸ëŠ” ë¬´ì‹œë¨. app/tests/test_invite_validate.py ì¶”ê°€ í•„ìš”. ë˜í•œ InviteCode ëª¨ë¸ì— expires_at/max_uses/used_count í•„ë“œê°€ ëˆ„ë½ëœ êµ¬í˜„ì´ ì¡´ì¬(simple_auth_models ë“±); ì‹¤ì œ DB/ë§ˆì´ê·¸ë ˆì´ì…˜ê³¼ ì •í•©ì„± ì¬ê²€ì¦ í•„ìš”.

- [âœ…] íšŒì›ê°€ì… API (POST /api/auth/signup)
  - ì²´í¬ ë°©ë²•: ìœ íš¨í•œ ì´ˆëŒ€ì½”ë“œì™€ ë‹‰ë„¤ì„ìœ¼ë¡œ íšŒì›ê°€ì… ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ì„±ê³µ ì‹œ ì‚¬ìš©ì ìƒì„± ë° JWT í† í° ë°œê¸‰, ì¤‘ë³µ/ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ì‘ë‹µ ë¨
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] í•„ìˆ˜ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ (site_id, nickname, phone_number?, password, invite_code)
- [âœ…] ë‹‰ë„¤ì„/ì•„ì´ë”” ì¤‘ë³µ ê²€ì‚¬
- [âœ…] ì´ˆëŒ€ì½”ë“œ ì‚¬ìš© ì²˜ë¦¬ (í˜„ì¬ 5858 ê³ ì • í—ˆìš©/ë¬´í•œì¬ì‚¬ìš©)
- [âœ…] ë¹„ë°€ë²ˆí˜¸ í•´ì‹±(bcrypt)
- [âŒ] ì´ˆê¸° ì‚¬ìš©ì ì„¤ì • (ê¸°ë³¸ ë“±ê¸‰/VIP/í† í° ì´ˆê¸°ê°’ ë“± ì¼ë¶€ ê°’ì€ ëª¨ë¸ê¸°ë³¸ê°’,  ì •ì±… í•©ì˜ í•„ìš”)


- [âœ…] íšŒì›ê°€ì… í›„ í† í° ë°œê¸‰
- [âœ…] ë¡œê·¸ì¸ API (POST /api/auth/login)
  - ì²´í¬ ë°©ë²•: ì˜¬ë°”ë¥¸/ì˜ëª»ëœ site_idì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ ì‹œë„
  - ê²€ì¦/ì„œë¹„ìŠ¤ì—  ê¸°ì¤€: ì¸ì¦ ì„±ê³µ ì‹œ JWT í† í° ë°œê¸‰, ì‹¤íŒ¨ ì‹œ 401 ì˜¤ë¥˜ 
  - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ì¸ì¦ ë¡œì§ (site_id + password ê¸°ë°˜)
- [âœ…] ë¡œê·¸ì¸ ì‹œë„ íšŸìˆ˜ ì œí•œ(ë½ì•„ì›ƒ): ìµœê·¼ ì‹¤íŒ¨ 5íšŒ ì‹œ 10ë¶„ê°„ 429 ì‘ë‹µ (env: LOGIN_MAX_FAILED_ATTEMPTS, LOGIN_LOCKOUT_MINUTES)
- [âœ…] ìµœê·¼ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸
- [âœ…] ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰ (HS256, ë§Œë£ŒëŠ” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES, ê¸°ë³¸ 30ë¶„)
- [âœ…] ë¦¬í”„ë ˆì‹œ í† í° ì €ì¥ì†Œ (DB) â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… ì‹œ refresh_token ë°œê¸‰ ë° ì €ì¥, /api/auth/refreshì—ì„œ ê²€ì¦/íšŒì „, /api/auth/logout(-all)ì—ì„œ íê¸°
- [âœ…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ë³„ì¹­ (GET /api/auth/me) â€” `/api/users/profile`ê³¼ ë™ì¹˜

[âœ…] JWT í† í° ë°œê¸‰/ê°±ì‹  API
  - ì²´í¬ ë°©ë²•: ë§Œë£Œëœ í† í°ìœ¼ë¡œ ê°±ì‹  ìš”ì²­, ìœ íš¨í•œ í† í°ìœ¼ë¡œ ë³´í˜¸ëœ API ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: í† í° ë§Œë£Œ/ê°±ì‹  ë©”ì»¤ë‹ˆì¦˜ì´ ì •ìƒ ì‘ë™ 
  - ì²´í¬ ëŒ€ìƒ:- [âœ…] í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (POST /api/auth/refresh) â€” Authorization Bearer ë˜ëŠ” { refresh_token } ë³¸ë¬¸ í—ˆìš©, ì‘ë‹µì— ì‹ ê·œ access_token ë°˜í™˜
  - [âœ…] ìœ íš¨ê¸°ê°„ ì„¤ì • â€” í™˜ê²½ë³€ìˆ˜ JWT_EXPIRE_MINUTES (ê¸°ë³¸ 30ë¶„)
    - [âœ…] í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] í† í° ê²€ì¦ ë¡œì§ (python-jose)
    - [âœ…] ë™ì‹œ ì„¸ì…˜ ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)
    - [âœ…] ê°•ì œ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ (êµ¬í˜„ ì™„ë£Œ)

- [âœ…] ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ API (GET /api/auth/me)
  - ì²´í¬ ë°©ë²•: JWT í† í°ìœ¼ë¡œ ë³´í˜¸ëœ ì—”ë“œí¬ì¸íŠ¸ ì ‘ê·¼
  - ê²€ì¦ ê¸°ì¤€: ìœ íš¨í•œ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜, ë¬´íš¨í•œ í† í°ì€ 401 ì˜¤ë¥˜ 
  - ë¹„ê³ : `/api/users/profile`ê³¼ ë°ì´í„° ë™ì¹˜. í…ŒìŠ¤íŠ¸ë¡œ ìƒí˜¸ ì¼ì¹˜ í™•ì¸.

    
### ì‚¬ìš©ì ì—¬ì • 2: ë©”ì¸ ë£¨í”„
- [âœ…] í”„ë¡œí•„ ì¡°íšŒ API (GET /api/users/profile, GET /api/auth/me; íƒ€ì¸: GET /api/users/{user_id})
  - ì²´í¬ ë°©ë²•: ìì‹ /íƒ€ì¸ì˜ í”„ë¡œí•„ ì¡°íšŒ ì‹œë„, ì¸ì¦ í† í° ì—†ì´ ì ‘ê·¼ ì‹œë„
  - ê²€ì¦ ê¸°ì¤€: ë³¸ì¸ ì •ë³´ëŠ” ìƒì„¸ ì¡°íšŒ, íƒ€ì¸ ì •ë³´ëŠ” ì œí•œì  ì¡°íšŒ ë˜ëŠ” ì°¨ë‹¨
  - í˜„ì¬ ìƒíƒœ: OpenAPI ê¸°ì¤€ìœ¼ë¡œ self ì—”ë“œí¬ì¸íŠ¸ëŠ” `/api/users/profile`ì´ë©°, `/api/users/{id}/profile`ëŠ” ë…¸ì¶œë˜ì§€ ì•ŠìŒ. `GET /api/auth/me`ëŠ” selfì™€ ë™ì¹˜. íƒ€ì¸ ì¡°íšŒëŠ” `GET /api/users/{user_id}`ë¡œ ì œí•œ ì •ë³´ ì œê³µ.
  - ì²´í¬ ëŒ€ìƒ:
    - [âœ…] ê¶Œí•œ ê¸°ë°˜ ì •ë³´ í•„í„°ë§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„ ë¡œì§ êµ¬í˜„)
    - [âœ…] ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ë‹‰ë„¤ì„, í† í°, ë­í¬)
  - [âœ…] í™œë™ í†µê³„ ê³„ì‚° (/api/users/stats ì§‘ê³„ êµ¬í˜„ ì™„ë£Œ)
  - [âœ…] ì§„í–‰ ì¤‘ì¸ ë¯¸ì…˜ì •ë³´ (/api/missions, ì¸ì¦ ì‚¬ìš©ì ê¸°ì¤€ ëª©ë¡/ë³´ìƒ ìˆ˜ë ¹ ì—°ë™)
    - [âœ…] ë³´ìœ  í† í°/í†µí™” ì •ë³´ (ì‚¬ì´ë²„ í† í° ì¡°íšŒ ì™„ë£Œ)
  - ì™„ë£Œëœ ì‘ì—…:
    -  backend/app/routers/users.py: í”„ë¡œí•„ API êµ¬í˜„ (Raw SQL ì‚¬ìš©)
    -  ê¶Œí•œë³„ ë°ì´í„° í•„í„°ë§ ë¡œì§ (ë³¸ì¸/íƒ€ì¸ êµ¬ë¶„)
    -  ê¸°ë³¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ (ID, ë‹‰ë„¤ì„, í† í°, ë­í¬)
    -  í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ì¤‘ë³µ ì œê±°, ProfileHeader í†µí•©)
    -  API ì‘ë‹µ êµ¬ì¡° ì •ì˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ
  - í…ŒìŠ¤íŠ¸ ê²°ê³¼:
    -  GET /api/users/profile â†’ 200 OK (self)
    -  GET /api/auth/me â†’ 200 OK (selfì™€ ë™ì¹˜)
    -  GET /api/users/{user_id} â†’ 200 OK (íƒ€ì¸ ì œí•œ ì •ë³´), ë¬´ì¸ì¦ ì ‘ê·¼ ì‹œ 401

    -  ì¤‘ë³µ ì»´í¬ë„ŒíŠ¸ ì •ë¦¬ (ModernProfileHeader ì œê±°)
  - í–¥í›„ ê°œì„ ì‚¬í•­:
    - [âœ…] ìƒì„¸ í™œë™ í†µê³„ ê³„ì‚° êµ¬í˜„ (/api/users/stats: UserAction/GameStats ì§‘ê³„ ê¸°ë°˜)
    - [âœ…]  ë¯¸ì…˜ ì§„í–‰ë„ API ì—°ë™ (/api/missions, /api/missions/{id}/claimì— ì¸ì¦ ì—°ë™)
    - [âœ…] íƒ€ì¸ í”„ë¡œí•„ ì¡°íšŒ ì‹œ ì œí•œì  ì •ë³´ í•„í„°ë§ (PublicUserResponse ìŠ¤í‚¤ë§ˆ ë„ì…)
    - [âœ…] ì¸ì¦ í† í° ê¸°ë°˜ ì ‘ê·¼ ì œì–´ ê°•í™” (missions ë¼ìš°í„°ì— get_current_user ì ìš©)

    êµ¬í˜„ í¬ì¸íŠ¸:
    - backend/app/services/user_service.py: get_user_stats ê³ ë„í™”(ì§‘ê³„ ê³„ì‚°, win_rate ë“±)
    - backend/app/routers/missions.py: í•˜ë“œì½”ë”©ëœ user_id ì œê±°â†’get_current_userë¡œ êµì²´
    - backend/app/schemas/user.py: PublicUserResponse ì¶”ê°€(íƒ€ì¸ ì œí•œ ì •ë³´)
    - backend/app/routers/users.py: GET /api/users/{user_id} ì‘ë‹µì„ UserResponse|PublicUserResponseë¡œ ë¶„ê¸°


- [âœ…] ìŠ¬ë¡¯ ê²Œì„ API (POST /api/actions/SLOT_SPIN)
  - ì²´í¬ ë°©ë²•: ì—°ì† ìŠ¤í•€ ì‹œë„, í™•ë¥  ë¶„í¬ ê²€ì¦ì„ ìœ„í•œ ëŒ€ëŸ‰ ìš”ì²­ í…ŒìŠ¤íŠ¸
  - ê²€ì¦ ê¸°ì¤€: ìŠ¤íŠ¸ë¦­ ì¹´ìš´íŠ¸ ì¦ê°€, ë³€ë™ ë¹„ìœ¨ ë³´ìƒ ë¡œì§ ì •ìƒ ë™ì‘
  - ì²´í¬ ëŒ€ìƒ:
  - [âœ…] ìŠ¬ë¡¯ ìŠ¤í•€ í™•ë¥  í…Œì´ë¸” (app.core.config.settings.SLOT_SYMBOL_WEIGHTSë¡œ ì™¸ë¶€í™”)
  - [âœ…] ìŠ¤íŠ¸ë¦­/ì—°ì† ë³´ìƒ ë©”ì»¤ë‹ˆì¦˜ (Redis streak ì¹´ìš´í„° + ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤ ìµœëŒ€ +20%, Â±5% ë³€ë™)
  - [âœ…] ê²°ê³¼ ê²°ì • ì•Œê³ ë¦¬ì¦˜ (ì‹¬ë³¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ 3ë¦´ + í˜ì–´/íŠ¸ë¦¬í”Œ ìŠ¹ë¦¬ íŒì •)
  - [âœ…] ëœë¤ ìƒì„±ê¸° í’ˆì§ˆ (Python random ì‚¬ìš©; CI ì‹œë“œ ê³ ì • ê²€í† )
  - [âœ…] ë³´ìƒ ì§€ê¸‰ ì—°ë™ (ë² íŒ… ì°¨ê°/ìŠ¹ë¦¬ê¸ˆ ë°˜ì˜)
  - [âœ…] ì‚¬ìš©ì ì•¡ì…˜ ë¡œê¹… (SLOT_SPIN, streak í¬í•¨)

- ì¶”ê°€ í…ŒìŠ¤íŠ¸:
- [âœ…] test_slot_distribution_sanity.py (300íšŒ ìƒ˜í”Œ ë¶„í¬ ë° í‰ê·  ìŠ¹ë¦¬ ì¶”ì„¸ ìŠ¤ëª¨í¬)

- [âœ…]ê°€ì±  ìŠ¤í•€ API (POST /api/games/gacha/pull)
- ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë“±ê¸‰ì˜ ì•„ì´í…œ ë“œë¡­ í™•ë¥  í…ŒìŠ¤íŠ¸ (1000íšŒ ì´ìƒ ì‹œë®¬ë ˆì´ì…˜)
- ê²€ì¦ ê¸°ì¤€: í™•ë¥  ë¶„í¬ê°€ ì„¤ì •ê°’ì˜ Â±5% ì´ë‚´, ë¡œê·¸ ì •í™•íˆ ê¸°ë¡
- ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë“±ê¸‰ë³„ ì•„ì´í…œ í™•ë¥  í…Œì´ë¸” (Legendary/Epic/Rare/Common + Near_Miss ë³€í˜•; service DEFAULT_RARITY_TABLE ë° í™˜ê²½ë³€ìˆ˜ ì˜¤ë²„ë¼ì´ë“œ)
- [âœ…] ì²œì¥/ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜ (90íšŒ ì‹¤íŒ¨ ì‹œ Epic ë³´ì¥, animation_type=pity)
- [âœ…] ê°€ì±  ë¹„ìš© ì°¨ê° ë¡œì§ (1ë½‘ 50, 10ë½‘ 450 í• ì¸)
- [âœ…] ì•„ì´í…œ ì§€ê¸‰ ë¡œì§ (near_miss ë§¤í•‘ í›„ ì‹¤ì œ rarityë¡œ ì§€ê¸‰)
- [âœ…] í™•ë¥  ê³µê°œ ì •ë³´ (/api/games/gacha/config)
- [âœ…] ê°€ì±  ê²°ê³¼ íˆìŠ¤í† ë¦¬ (/api/games/gacha/stats + UserAction ë¡œê·¸ì— ê²°ê³¼/ì—°ì¶œ ê¸°ë¡)
- í…ŒìŠ¤íŠ¸ í—ˆìš©ì˜¤ì°¨: Â±5% (í…ŒìŠ¤íŠ¸ ë‚´ random.seed ê³ ì •)

 [âš ï¸] ë³´ìƒ ì§€ê¸‰ API (POST /api/rewards)
 - ì²´í¬ ë°©ë²•: ë‹¤ì–‘í•œ ë³´ìƒ ìœ í˜• ì§€ê¸‰ í…ŒìŠ¤íŠ¸, ë™ì‹œ ë‹¤ìˆ˜ ìš”ì²­ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
 - ê²€ì¦ ê¸°ì¤€: ì‚¬ìš©ì ì”ì•¡/ì¸ë²¤í† ë¦¬ ì •í™•íˆ ì—…ë°ì´íŠ¸, ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€
 - ì²´í¬ ëŒ€ìƒ:
- [âœ…] ë³´ìƒ ìœ í˜•ë³„ ì²˜ë¦¬ (ì½”ì¸, ì ¬, ì•„ì´í…œ) â€” TOKEN/COIN í†µí™” ë°˜ì˜, ITEM ê¸°ë¡
- [âœ…] íŠ¸ëœì­ì…˜ ì²˜ë¦¬ (ì›ìì„±) â€” Reward + UserReward ë™ì‹œ ì»¤ë°‹, ì˜¤ë¥˜ ì‹œ ë¡¤ë°±
- [âœ…] ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ (idempotency) â€” UserAction(REWARD_GRANT + idempotency_key)ë¡œ ì¬ì‹œë„ ì•ˆì „
- [âœ…] ë³´ìƒ íˆìŠ¤í† ë¦¬ ê¸°ë¡ â€” GET /api/rewards/users/{user_id}/rewards í˜ì´ì§€ë„¤ì´ì…˜, claimed_at ê¸°ì¤€ ì •ë ¬\
- [âš ï¸] íŠ¹ë³„ ë³´ìƒ ì²˜ë¦¬ (ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜) â€” ë²”ìœ„ í™•ì¥ ì‹œ ì¶”ê°€ ëª¨ë¸ë§ ì˜ˆì •
- [âœ…] ì•Œë¦¼ ì—°ë™ (ë³´ìƒ ì§€ê¸‰ ì•Œë¦¼) â€” WebSocket best-effort ê°œì¸ ì•Œë¦¼ ì „ì†¡

ê²€ì¦ ë©”ëª¨(2025-08-12):
- app/tests/test_rewards_distribution.py 2ê±´ PASS. ëª©ë¡ APIëŠ” UserRewardâ†”Reward ì¡°ì¸ìœ¼ë¡œ RewardItem(reward_id, reward_type, reward_value, awarded_at=claimed_at) í˜•íƒœ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •.


## (2025-08-16) ì„¸ì…˜ & í† í° ì‹¤ì‹œê°„ ê¸°ëŠ¥ ì—…ë°ì´íŠ¸
- GameSession í…Œì´ë¸”(Alembic 20250816_add_game_sessions_table) ë„ì…: int PK + external_session_id(UUID) unique, ì¸ë±ìŠ¤(user_id+status, user_id+game_type, start_time, created_at)
- /api/games/session/start,end ì˜ì†í™”: í™œì„± ì¤‘ë³µ 409, ì¢…ë£Œ ì‹œ total_rounds/total_bet/total_win ê¸°ë¡
- /api/games/session/active ì¶”ê°€, GameHistory SESSION_START/END ë¡œê¹…
- WebSocket: game_session ì´ë²¤íŠ¸( start/end ) í™•ì¥ + token_update ì´ë²¤íŠ¸(TokenService add/deduct hook)
- í–¥í›„ í™•ì¥ ì˜ˆì •: token_updateì— history_id, balance_coin/gem ì„¸ë¶„í™”, ì„¸ì…˜ ë¼ìš´ë“œ ìë™ ëˆ„ì  ë° ROI

### ê²€ì¦ (ê³„íš/ìˆ˜í–‰)
- [ ] alembic upgrade head í›„ game_sessions ì¡´ì¬ ë° ì¸ë±ìŠ¤ í™•ì¸(ix_game_sessions_*)