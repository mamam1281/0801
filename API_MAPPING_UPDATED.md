# API ë§¤í•‘ ë° ì¸ì¦ ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. Docker í™˜ê²½ ì‹œì‘
```bash
# PowerShellì—ì„œ ì‹¤í–‰
./docker-manage-simple.ps1 start --tools
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…Œì´ë„ˆì— ì ‘ì†
docker exec -it your_db_container_name psql -U your_db_user -d your_db_name

# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
\i /path/to/your/init_script.sql
```

### 3. ë°±ì—”ë“œ ì„œë²„ ì‹œì‘
```bash
# ë°±ì—”ë“œ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart backend
```

### 4. í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œì‘
```bash
# í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤ ì¬ì‹œì‘
docker-compose restart frontend
```

## ë¬¸ì œ ì§„ë‹¨

í˜„ì¬ Casino-Club F2P ë°±ì—”ë“œì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤:

1. `/api/auth/signup` ì—”ë“œí¬ì¸íŠ¸ê°€ 404 Not Found ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•¨
2. ì‹¤ì œë¡œëŠ” `/auth/register` ì—”ë“œí¬ì¸íŠ¸ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì´ ë˜í•œ 500 Internal Server Error ë°˜í™˜í•¨
3. API êµ¬ì¡°ê°€ ì¼ê´€ì„± ì—†ì´ ë¶„ë¦¬ë˜ì–´ ìˆìŒ

## ì›ì¸ ë¶„ì„

### 1. ëª¨ë“ˆ êµ¬ì¡° ë¬¸ì œ

- `app/routers/auth.py` íŒŒì¼ê³¼ `app/routers/auth/` ë””ë ‰í† ë¦¬ê°€ ë™ì‹œì— ì¡´ì¬
- Pythonì˜ ëª¨ë“ˆ ì‹œìŠ¤í…œì—ì„œ ë””ë ‰í† ë¦¬ê°€ ìš°ì„ ìˆœìœ„ë¥¼ ê°€ì§€ë¯€ë¡œ, `import auth`ëŠ” í•­ìƒ ë””ë ‰í† ë¦¬ë¥¼ ê°€ë¦¬í‚´
- `app/routers/auth/__init__.py`ì—ì„œ `from ..auth import router`ë¥¼ ì‹œë„í•˜ì—¬ ìˆœí™˜ ì„í¬íŠ¸ ë°œìƒ

### 2. ì—”ë“œí¬ì¸íŠ¸ ë¶ˆì¼ì¹˜

- í´ë¼ì´ì–¸íŠ¸ëŠ” `/api/auth/signup`ì„ í˜¸ì¶œí•˜ì§€ë§Œ ì‹¤ì œ APIëŠ” `/auth/register` ì œê³µ
- ë‘ ë¼ìš°í„° ê°„ì— prefixì™€ ê²½ë¡œ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ

### 3. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ê´€ê³„ ë¬¸ì œ

- User ëª¨ë¸ê³¼ SecurityEvent ëª¨ë¸ ê°„ì˜ ê´€ê³„ ì •ì˜ì— ë¬¸ì œ ì¡´ì¬
- Foreign Key ì •ì˜ê°€ ì—†ê±°ë‚˜ ì˜ëª» ì„¤ì •ë¨

## í•´ê²° ë°©ì•ˆ

### ë°©ì•ˆ 1: í†µí•©ëœ auth.py ì‚¬ìš© (ê¶Œì¥)

1. `app/routers/auth/` ë””ë ‰í† ë¦¬ë¥¼ ì‚­ì œ
2. `app/routers/auth.py`ë§Œ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
3. ë¼ìš°í„°ì˜ prefixë¥¼ `/api/auth`ë¡œ í†µì¼
4. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ì˜ ê´€ê³„ ìˆ˜ì •

### ë°©ì•ˆ 2: auth_endpoints.py êµ¬ì¡° ìˆ˜ì •

1. `app/auth/auth_endpoints.py` íŒŒì¼ì˜ ë¼ìš°í„° prefixë¥¼ `/api/auth`ë¡œ ë³€ê²½
2. `app/routers/auth.py` íŒŒì¼ ì‚­ì œ
3. `app/routers/auth/__init__.py`ì—ì„œ ì˜¬ë°”ë¥¸ ê²½ë¡œë¡œ ì„í¬íŠ¸

### ë°©ì•ˆ 3: í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ìˆ˜ì •

1. í´ë¼ì´ì–¸íŠ¸ì—ì„œ `/api/auth/signup` ëŒ€ì‹  `/auth/register` í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½
2. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ì˜ ê´€ê³„ ìˆ˜ì •

## ì¸ì¦ ì‹œìŠ¤í…œ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. íšŒì›ê°€ì…
- [x] ì´ˆëŒ€ ì½”ë“œ í™•ì¸ ê¸°ëŠ¥ ê²€ì¦
  - ìœ íš¨í•œ ì´ˆëŒ€ ì½”ë“œ: `5858` (ë¬´í•œ ì¬ì‚¬ìš© ê°€ëŠ¥)
  - ì˜ëª»ëœ ì´ˆëŒ€ ì½”ë“œ ì…ë ¥ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ 
- [x] íšŒì›ê°€ì… í¼ ì‘ë™ í™•ì¸
  - í•„ìˆ˜ í•„ë“œ: ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸(4ê¸€ì ì´ìƒ), ë‹‰ë„¤ì„, ì „í™”ë²ˆí˜¸, ì´ˆëŒ€ ì½”ë“œ
- [x] ìœ íš¨í•œ ì´ˆëŒ€ ì½”ë“œë¡œ íšŒì›ê°€ì… ì„±ê³µ
  - ì´ˆëŒ€ ì½”ë“œ `5858` ì‚¬ìš© âœ… ë¬´í•œ ì¬ì‚¬ìš© ê°€ëŠ¥
- [x] ì¤‘ë³µ ì•„ì´ë”” ê²€ì‚¬ ê¸°ëŠ¥
  - ì´ë¯¸ ë“±ë¡ëœ ì•„ì´ë””/ë‹‰ë„¤ì„/ì „í™”ë²ˆí˜¸ë¡œ ê°€ì… ì‹œë„ ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€
- [x] ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ê²€ì‚¬
  - ìš”êµ¬ì‚¬í•­: 4ìë¦¬ ì´ìƒ

### 2. ë¡œê·¸ì¸
- [x] ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ ê¸°ë³¸ êµ¬ì¡° 
- [x] ì˜ëª»ëœ ìê²©ì¦ëª… ì‹œ ì ì ˆí•œ ì˜¤ë¥˜ ë©”ì‹œì§€
- [x] JWT í† í° ìƒì„± ë¡œì§
- [x] ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì™„ì „ í…ŒìŠ¤íŠ¸
- [x] ê´€ë¦¬ì ë¡œê·¸ì¸ ì™„ì „ í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ í›„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜ (í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ í•„ìš”)

### 3. í† í° ê´€ë¦¬
- [x] í† í° ìƒì„± ë° ê²€ì¦ ë¡œì§
- [x] í† í° íŒŒì‹± ë° ì‚¬ìš©ì ì¸ì¦
- [x] ê´€ë¦¬ì ê¶Œí•œ í† í° ê²€ì¦
- [x] í† í° ë§Œë£Œ ì‹œ ìë™ ê°±ì‹  ê¸°ëŠ¥
- [x] ê°±ì‹  í† í° ë§Œë£Œ ì²˜ë¦¬
- [x] ë¡œê·¸ì•„ì›ƒ ì‹œ í† í° ì œê±° 

## ê´€ë ¨ íŒŒì¼ êµ¬ì¡°

```
app/
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ auth.py                 # í˜„ì¬ main.pyì—ì„œ ì°¸ì¡°í•˜ëŠ” íŒŒì¼
â”‚   â”œâ”€â”€ auth/                   # ë””ë ‰í† ë¦¬ë„ ë™ì‹œì— ì¡´ì¬í•˜ì—¬ ì¶©ëŒ ë°œìƒ
â”‚   â”‚   â””â”€â”€ __init__.py         # ë¬¸ì œê°€ ë˜ëŠ” ì„í¬íŠ¸ êµ¬ë¬¸ ì¡´ì¬
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ auth_endpoints.py       # ì‹¤ì œ ë“±ë¡ëœ ë¼ìš°í„° (prefix="/auth")
```

## ì‹¤ì œ ì‚¬ìš© ê°€ëŠ¥í•œ ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸

í˜„ì¬ ìƒí™©ì—ì„œ ìˆ˜ì •ëœ ì¸ì¦ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì†Œë“œ | ì„¤ëª… | ìš”ì²­ ë³¸ë¬¸ | ì‘ë‹µ |
|------------|--------|------|-----------|------|
| `/api/auth/verify-invite` | POST | ì´ˆëŒ€ ì½”ë“œ ìœ íš¨ì„± ê²€ì¦ | `{"inviteCode": "string"}` | `{"valid": true/false, "message": "string"}` |
| `/api/auth/signup` | POST | ìƒˆë¡œìš´ ì‚¬ìš©ì ë“±ë¡ | `{"username": "string", "password": "string", "nickname": "string", "inviteCode": "string"}` | JWT í† í° + ì‚¬ìš©ì ì •ë³´ |
| `/api/auth/login` | POST | ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ | `{"username": "string", "password": "string"}` | JWT í† í° + ì‚¬ìš©ì ì •ë³´ |
| `/api/auth/admin/login` | POST | ê´€ë¦¬ì ë¡œê·¸ì¸ | `{"site_id": "string", "password": "string"}` | JWT í† í° + ì‚¬ìš©ì ì •ë³´ |
| `/api/auth/refresh` | POST | í† í° ê°±ì‹  | `{"refreshToken": "string"}` | ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í° |
| `/api/auth/logout` | POST | ë¡œê·¸ì•„ì›ƒ | _Bearer í† í° í•„ìš”_ | `{"message": "string"}` |

### API ì‘ë‹µ í˜•ì‹

#### ì„±ê³µ ì‘ë‹µ (200 OK)
```json
{
    "access_token": "string",
    "token_type": "bearer",
    "user": {
        "id": "number",
        "site_id": "string",
        "nickname": "string",
        "phone_number": "string",
        "cyber_token_balance": "number",
        "created_at": "datetime",
        "last_login": "datetime",
        "is_admin": "boolean",
        "is_active": "boolean"
    }
}
```

#### ì˜¤ë¥˜ ì‘ë‹µ 
```json
{
    "detail": "string"  // ì˜¤ë¥˜ ë©”ì‹œì§€
}
```

### HTTP ìƒíƒœ ì½”ë“œ
- 200: ì„±ê³µ
- 400: ì˜ëª»ëœ ìš”ì²­ (ìœ íš¨í•˜ì§€ ì•Šì€ ì´ˆëŒ€ ì½”ë“œ, ì¤‘ë³µëœ ì‚¬ìš©ì ë“±)
- 401: ì¸ì¦ ì‹¤íŒ¨ (ì˜ëª»ëœ ìê²©ì¦ëª…)
- 403: ê¶Œí•œ ì—†ìŒ
- 404: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
- 500: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜

### íŠ¹ì´ì‚¬í•­
1. ì´ˆëŒ€ ì½”ë“œ `5858`ì€ ê°œë°œ í™˜ê²½ì—ì„œ ë¬´í•œ ì¬ì‚¬ìš© ê°€ëŠ¥
2. ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ìë¦¬ ì´ìƒ í•„ìš”
3. í† í° ë§Œë£Œ ì‹œê°„
   - ì•¡ì„¸ìŠ¤ í† í°: 1ì‹œê°„
   - ë¦¬í”„ë ˆì‹œ í† í°: 7ì¼
| `/auth/logout` | POST | ë¡œê·¸ì•„ì›ƒ | ë¯¸í™•ì¸ |
| `/auth/profile` | GET | ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ | ë¯¸í™•ì¸ |
| `/auth/sessions` | GET | í™œì„± ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ | ë¯¸í™•ì¸ |

def authenticate_user(self, username: str, password: str) -> User
def authenticate_admin(self, username: str, password: str) -> User
def verify_token(self, token: str) -> dict
def create_refresh_token(self, data: dict) -> str
def verify_refresh_token(self, token: str) -> dict
def blacklist_token(self, token: str) -> None
def is_token_blacklisted(self, token: str) -> bool

class TokenBlacklist:
    token: str
    expires_at: datetime
    blacklisted_at: datetime
    blacklisted_by: int  # user_id




## ê¶Œì¥ ìµœì¢… í•´ê²°ì±…

1. `app/routers/auth/` ë””ë ‰í† ë¦¬ ì‚­ì œ
2. `app/routers/auth.py` íŒŒì¼ì— ë¼ìš°í„° ì •ì˜ í†µí•©
3. `app/auth/auth_endpoints.py` íŒŒì¼ì˜ ê¸°ëŠ¥ì„ `app/routers/auth.py`ë¡œ ë³‘í•©
4. ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ì˜ ê´€ê³„ ìˆ˜ì • (Userì™€ SecurityEvent ëª¨ë¸)
5. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì—ì„œëŠ” `/api/auth/signup` ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©

## ì§„í–‰ ìƒí™©

- [x] ë¬¸ì œ ì§„ë‹¨ ì™„ë£Œ
- [x] ì›ì¸ ë¶„ì„ ì™„ë£Œ
- [ ] ëª¨ë“ˆ êµ¬ì¡° ìˆ˜ì •
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë¸ ìˆ˜ì •
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í†µì¼
- [ ] ì¸ì¦ ì‹œìŠ¤í…œ ì™„ì „ í…ŒìŠ¤íŠ¸
